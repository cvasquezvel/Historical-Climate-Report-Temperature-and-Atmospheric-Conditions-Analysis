---
title: "Reporte de clima"
author: 
 - PhD(c). Christian Vásquez-Velasco
date: "`r Sys.Date()`"
output: html_document
---

```{=html}
<style>
body {
text-align: justify}
</style>
```
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(max.print = 9999,
        scipen = 999)
library(pacman)
pacman::p_load(jpeg, png, ggplot2, lubridate, readxl, reshape2, tibbletime, dplyr, extrafont, ggthemes, tidyverse, gridExtra, grid, gtable, ISOweek, ggpubr, ggrepel, plotly, scales)
#devtools::install_github("AliciaSchep/gglabeller") 
# image2 <- png::readPNG("acp.png")
```

```{r, echo = F, include=F, message=FALSE, warning=FALSE, comment = NA, fig.align='center', fig.width=6, fig.height=4}
#######################
# CREATING PLOT THEMES
#######################
library(extrafont)

# Create Base Theme
#------------------
theme_elegante <- function(base_size = 10,
                           base_family = "Raleway"
                           )
    {
    color.background = "#FFFFFF" # Chart Background
    color.grid.major = "#D9D9D9" # Chart Gridlines
    color.axis.text = "#666666" # 
    color.axis.title = "#666666" # 
    color.title = "#666666"
    color.subtitle = "#666666"
    strip.background.color = '#9999CC'
    
    ret <-
        theme_bw(base_size=base_size) +
        
        # Set the entire chart region to a light gray color
        # theme(panel.background=element_rect(fill=color.background, color=color.background)) +
        theme(panel.background = element_rect(fill = "white", 
            colour = NA)) +
        theme(plot.background=element_rect(fill=color.background, color=color.background)) +
        # theme(panel.border=element_rect(color=color.background)) +
        theme(panel.border=element_rect(fill = NA, 
            colour = "grey20")) +
        
        # Format the grid
        theme(panel.grid = element_line(colour = color.grid.major)) +
        theme(panel.grid.major=element_line(color=color.grid.major,size=.55, linetype="solid")) +
        # theme(panel.grid.minor=element_line(color=color.grid.major,size=.55, linetype="solid")) +
        theme(panel.grid.minor=element_line(color=color.grid.major, linetype="solid",
                                            size = rel(0.5))) +
        theme(axis.ticks=element_blank()) +
        
        # Format the legend, but hide by default
        theme(legend.position="none") +
        theme(legend.background = element_rect(fill=color.background)) +
        theme(legend.text = element_text(size=base_size-3,color=color.axis.title, family = base_family)) +
        
        theme(strip.text.x = element_text(size=base_size,color=color.background, family = base_family)) +
        theme(strip.text.y = element_text(size=base_size,color=color.background, family = base_family)) +
        #theme(strip.background = element_rect(fill=strip.background.color, linetype="blank")) +
        theme(strip.background = element_rect(fill = "grey70", colour = "grey20")) +
        # theme(panel.border= element_rect(fill = NA, colour = "grey70", size = rel(1)))+
        # Set title and axis labels, and format these and tick marks
        theme(plot.title=element_text(color=color.title, 
                                      size=20, 
                                      vjust=1.25, 
                                      family=base_family, 
                                      hjust = 0.5
                                      )) +
        
        theme(plot.subtitle=element_text(color=color.subtitle, size=base_size+2, family = base_family,  hjust = 0.5))  +
        
        theme(axis.text.x=element_text(size=base_size,color=color.axis.text, family = base_family,
                                       angle=90, hjust=0.5)) +
        theme(axis.text.y=element_text(size=base_size,color=color.axis.text, family = base_family)) +
        theme(text=element_text(size=base_size, color=color.axis.text, family = base_family)) +
        
        theme(axis.title.x=element_text(size=base_size+2,color=color.axis.title, vjust=0, family = base_family)) +
        theme(axis.title.y=element_text(size=base_size+2,color=color.axis.title, vjust=1.25, family = base_family)) +
        theme(plot.caption=element_text(size=base_size-2,color=color.axis.title, vjust=1.25, family = base_family)) +
        
        # Legend  
        theme(legend.text=element_text(size=base_size,color=color.axis.text, family = base_family)) +
        theme(legend.title=element_text(size=base_size,color=color.axis.text, family = base_family)) +
        theme(legend.key=element_rect(colour = color.background, fill = color.background)) +
        theme(legend.position="bottom", 
              legend.box = "horizontal", 
              legend.title = element_blank(),
              legend.key.width = unit(.75, "cm"),
              legend.key.height = unit(.75, "cm"),
              legend.spacing.x = unit(.25, 'cm'),
              legend.spacing.y = unit(.25, 'cm'),
              legend.margin = margin(t=0, r=0, b=0, l=0, unit="cm")) +

        # Plot margins
        theme(plot.margin = unit(c(.5, .5, .5, .5), "cm"))
    
    ret
}

```


# {.tabset .tabset-fade .tabset-pills}

## Fundo Agromorín {.tabset .tabset-fade .tabset-pills}

```{r,echo=FALSE,comment=NA, warning=FALSE,message=FALSE}
all_na <- function(x) any(!is.na(x))
spaceless <- function(x) {colnames(x) <- gsub(c("\\s\\s"), " ", colnames(x));x}

datos_clima <- readxl::read_excel("Datos clima 2.xlsx",sheet = "Agromorin")
clima_pre <- datos_clima %>%
  mutate(#Semana = isoweek(Date),
    Fecha = ceiling_date(Date, "week"),
    Semana = isoweek(Fecha),
    Date = as.Date(Date, format = "%Y%m%d"),
    `Temp. Media (°C)` = (`Temp. Maxima (°C)`+`Temp. Minima (°C)`)/2#,
    #Año_corregido = year(ceiling_date(Date, "week")),
    #DiadelAño = as.numeric(format(Date, format = "%j")),
    #DiadelMes = as.numeric(format(Date, format = "%d")),
    #DiadelaSemana = as.numeric(format(Date, format = "%u")),
    #MesdelAño = as.numeric(format(Date, format = "%m"))
  ) %>%
  dplyr::select_if(all_na)%>%
  # janitor::clean_names()
  spaceless() %>%
  dplyr::mutate(Time = round(Time*24,0),
                Date2 = if_else(Time != 0, Date, Date-1),
                DiadelAño = as.numeric(format(Date2, format = "%j")),
                DiadelMes = as.numeric(format(Date2, format = "%d")),
                DiadelaSemana = as.numeric(format(Date2, format = "%u")),
                Año = lubridate::year(Date))

# clima_means <- clima_pre %>%
#   dplyr::filter(is.na(Time)) %>%
#   dplyr::select(Date,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
#                 `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
#                 `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
#                 `Factor enfria por Viento (°C)`,`Indice de Calor`,
#                 `Indice de Tem. Hum. Viento`,
#                 `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
#                 `Grados Caloricos dia (°C)`,
#                 `Grados Frio (°C)`, `Temp. Interna (°C)`,
#                 `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
#                 `Evapotranspiracion (mm)`,`Lluvia (mm)`,`Temp. Maxima (°C)`,
#                 `Temp. Minima (°C)`,`Temp. Media (°C) mean (°C)`,`Radiacion Solar (w/m2)`,
#                 `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
#                 `Indice Rayos UV`, `Dosis UV`, `Alta Radiacion UV`)

clima_means <- clima_pre %>%
  dplyr::group_by(Date2) %>%
  dplyr::summarise_if(is.numeric, mean, na.rm = TRUE) %>%
  dplyr::ungroup() %>%
  dplyr::select(Date2,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
                `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
                `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
                `Factor enfria por Viento (°C)`,`Indice de Calor`,
                `Indice de Tem. Hum. Viento`,
                `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
                `Temp. Interna (°C)`,
                `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
                #`Evapotranspiracion (mm)`,`Lluvia (mm)`,
                # `Temp. Maxima (°C)`,
                # `Temp. Minima (°C)`,`Temp. Media (°C)`,`Radiacion Solar (w/m2)`,
                `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
                `Indice Rayos UV`, # `Dosis UV`,
                `Alta Radiacion UV`) %>%
  dplyr::rename(Date = Date2)

# colnames(clima_means)[-1] <- paste(colnames(clima_means)[-1], "mean", sep = " ")

# clima_max <- clima_pre %>%
#   dplyr::group_by(Date2) %>%
#   dplyr::summarise_if(is.numeric, max, na.rm = TRUE) %>%
#   dplyr::ungroup() %>%
#   dplyr::select(Date2,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
#                 `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
#                 `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
#                 `Factor enfria por Viento (°C)`,`Indice de Calor`,
#                 `Indice de Tem. Hum. Viento`,
#                 `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
#                 `Grados Caloricos dia (°C)`,
#                 `Grados Frio (°C)`, `Temp. Interna (°C)`,
#                 `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
#                 `Evapotranspiracion (mm)`,`Lluvia (mm)`,`Temp. Maxima (°C)`,
#                 `Temp. Minima (°C)`,`Temp. Media (°C)`,`Radiacion Solar (w/m2)`,
#                 `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
#                 `Indice Rayos UV`, `Dosis UV`, `Alta Radiacion UV`) %>%
#   dplyr::rename(Date = Date2)
# colnames(clima_max)[-1] <- paste(colnames(clima_max)[-1], "max", sep = " ")
# 
# clima_min <- clima_pre %>%
#   dplyr::group_by(Date2) %>%
#   dplyr::summarise_if(is.numeric, min, na.rm = TRUE) %>%
#   dplyr::ungroup() %>%
#   dplyr::select(Date2,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
#                 `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
#                 `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
#                 `Factor enfria por Viento (°C)`,`Indice de Calor`,
#                 `Indice de Tem. Hum. Viento`,
#                 `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
#                 `Grados Caloricos dia (°C)`,
#                 `Grados Frio (°C)`, `Temp. Interna (°C)`,
#                 `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
#                 `Evapotranspiracion (mm)`,`Lluvia (mm)`,`Temp. Maxima (°C)`,
#                 `Temp. Minima (°C)`,`Temp. Media (°C)`,`Radiacion Solar (w/m2)`,
#                 `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
#                 `Indice Rayos UV`, `Dosis UV`, `Alta Radiacion UV`) %>%
#   dplyr::rename(Date = Date2)
# colnames(clima_min)[-1] <- paste(colnames(clima_min)[-1], "min", sep = " ")

clima_horas <- clima_pre %>%
  dplyr::filter(!is.na(Time)) %>%
  #recipes::step_nzv(all_predictors()) %>%
  dplyr::group_by(Date2,Time) %>%
  dplyr::summarise(`Temp. Maxima (°C)` = max(`Temp. Maxima (°C)`,na.rm = TRUE),
                   `Temp. Minima (°C)` = min(`Temp. Minima (°C)`,na.rm = TRUE),
                   #`Temp. Media (°C)` = (`Temp. Maxima (°C)`+`Temp. Minima (°C)`)/2,
                   `Dias Grado` = (`Temp. Exterior (°C)` - 10)/24,
                   `Dias Grado` = ifelse(`Dias Grado` < 0, 0, `Dias Grado`),
                   `Horas Rocio` = sum(`Horas Rocio`, na.rm = TRUE)) %>%
  dplyr::ungroup() %>%
  dplyr::group_by(Date2) %>%
  dplyr::summarise(`Horas Calor` = sum(`Temp. Minima (°C)`>=24, na.rm = TRUE)/n()*24,
                   `Horas Frio` = sum(`Temp. Maxima (°C)`<=15, na.rm = TRUE)/n()*24,
                   `Dias Grado` = sum(`Dias Grado`)/n()*24,
                   `Dias Grado` = ifelse(`Dias Grado` < 0, 0, `Dias Grado`),
                   `Horas Rocio` = sum(`Horas Rocio`)/n()*24,
                   `Horas Rocio` = ifelse(`Horas Rocio` < 0, 0, `Horas Rocio`)) %>%
  dplyr::ungroup() %>%
  dplyr::rename(Date = Date2) %>%
  tidyr::replace_na(list(`Dias Grado` = 0,
                         `Horas Rocio` = 0))

clima_temp <- clima_pre %>%
  dplyr::filter(!is.na(Time)) %>%
  #recipes::step_nzv(all_predictors()) %>%
  dplyr::group_by(Date2) %>%
  dplyr::summarise(`Temp. Maxima (°C)` = max(`Temp. Maxima (°C)`,na.rm = TRUE),
                   `Temp. Minima (°C)` = min(`Temp. Minima (°C)`,na.rm = TRUE),
                   `Temp. Media (°C)` = (`Temp. Maxima (°C)`+`Temp. Minima (°C)`)/2,
                   `Radiacion Solar (w/m2)` = max(`Radiacion Solar (w/m2)`, na.rm = TRUE),
                   `Evapotranspiracion (mm)` = sum(`Evapotranspiracion (mm)`, na.rm = TRUE),
                   `Lluvia (mm)` = sum(`Lluvia (mm)`, na.rm = TRUE),
                   `Deficit de presion de vapor (DPV)` = mean(`DPVfinal`, na.rm = TRUE),
                   `Grados Calor (18.3 °C)` = sum(`GC`, na.rm = TRUE),
                   `Grados Frio (18.3 °C)` = sum(`GF`, na.rm = TRUE), 
                   `Grados Calor (10 °C)` = sum(`GC10`, na.rm = TRUE),
                   `Grados Frio (10 °C)` = sum(`GF10`, na.rm = TRUE), 
                   `Grados Calor (15 °C)` = sum(`GC15`, na.rm = TRUE),
                   `Grados Frio (15 °C)` = sum(`GF15`, na.rm = TRUE), 
                   `Grados Calor (24 °C)` = sum(`GC24`, na.rm = TRUE),
                   `Grados Frio (24 °C)` = sum(`GF24`, na.rm = TRUE)) %>%
  dplyr::ungroup() %>%
  dplyr::rename(Date = Date2)

clima_dia <- clima_means %>%
  left_join(clima_temp, by = c("Date")) %>%
  left_join(clima_horas, by = c("Date"))

clima <- clima_dia %>%
  mutate(Date = ceiling_date(Date, "week")) %>%
  group_by(Date) %>%
  summarise(`Temp. Maxima (°C) max` = max(`Temp. Maxima (°C)`,na.rm = TRUE),
            `Temp. Maxima (°C) mean` = mean(`Temp. Maxima (°C)`,na.rm = TRUE),
            `Temp. Maxima (°C) sd` = sd(`Temp. Maxima (°C)`,na.rm = TRUE),
            `Temp. Minima (°C) min` = min(`Temp. Minima (°C)`,na.rm = TRUE),
            `Temp. Minima (°C) mean` = mean(`Temp. Minima (°C)`,na.rm = TRUE),
            `Temp. Minima (°C) sd` = sd(`Temp. Minima (°C)`,na.rm = TRUE),
            `Temp. Media (°C) mean` = mean(`Temp. Media (°C)`,na.rm = TRUE),
            `Temp. Media (°C) sd` = sd(`Temp. Media (°C)`,na.rm = TRUE),
            `Temp. Exterior (°C) mean` = mean(`Temp. Exterior (°C)`,na.rm = TRUE),
            `Temp. Exterior (°C) sd` = sd(`Temp. Exterior (°C)`,na.rm = TRUE),
            `Humedad Externa (%) mean` = mean(`Humedad Externa (%)`,na.rm = TRUE),
            `Humedad Externa (%) sd` = sd(`Humedad Externa (%)`,na.rm = TRUE),
            `Horas Calor sum` = sum(`Horas Calor`, na.rm = TRUE),
            `Horas Calor sd` = sd(`Horas Calor`, na.rm = TRUE),
            `Horas Frio sum` = sum(`Horas Frio`, na.rm = TRUE),
            `Horas Frio sd` = sd(`Horas Frio`, na.rm = TRUE),
            `Dias Grado sum` = sum(`Dias Grado`, na.rm = TRUE),
            `Dias Grado sd` = sd(`Dias Grado`, na.rm = TRUE),
            `Horas Rocio sum` = sum(`Horas Rocio`, na.rm = TRUE),
            `Horas Rocio sd` = sd(`Horas Rocio`, na.rm = TRUE),
            `Lluvia (mm) sum` = sum(`Lluvia (mm)`, na.rm = TRUE),
            `Lluvia (mm) mean` = mean(`Lluvia (mm)`, na.rm = TRUE),
            `Lluvia (mm) sd` = sd(`Lluvia (mm)`, na.rm = TRUE),
            `Radiacion Solar (w/m2) mean` = mean(`Radiacion Solar (w/m2)`, na.rm = TRUE),
            `Radiacion Solar (w/m2) sd` = sd(`Radiacion Solar (w/m2)`, na.rm = TRUE),
            `Evapotranspiracion (mm) sum` = sum(`Evapotranspiracion (mm)`, na.rm = TRUE),
            `Evapotranspiracion (mm) mean` = mean(`Evapotranspiracion (mm)`, na.rm = TRUE),
            `Evapotranspiracion (mm) sd` = sd(`Evapotranspiracion (mm)`, na.rm = TRUE),
            `Punto Rocio (°C) mean` = mean(`Punto Rocio (°C)`, na.rm = TRUE),
            `Punto Rocio (°C) sd` = sd(`Punto Rocio (°C)`, na.rm = TRUE),
            `Vel. Min Viento (km/hr) mean` = mean(`Vel. Min Viento (km/hr)`, na.rm = TRUE),
            `Vel. Min Viento (km/hr) sd` = sd(`Vel. Min Viento (km/hr)`, na.rm = TRUE),
            `Viento Durante un Intervalo mean` = mean(`Viento Durante un Intervalo`, na.rm = TRUE),
            `Viento Durante un Intervalo sd` = sd(`Viento Durante un Intervalo`, na.rm = TRUE),
            `Velocida Max (km/hr) mean` = mean(`Velocida Max (km/hr)`, na.rm = TRUE),
            `Velocida Max (km/hr) sd` = sd(`Velocida Max (km/hr)`, na.rm = TRUE),
            `Factor enfria por Viento (°C) mean` = mean(`Factor enfria por Viento (°C)`, na.rm = TRUE),
            `Factor enfria por Viento (°C) sd` = sd(`Factor enfria por Viento (°C)`, na.rm = TRUE),
            `Indice de Calor mean` = mean(`Indice de Calor`, na.rm = TRUE),
            `Indice de Calor sd` = sd(`Indice de Calor`, na.rm = TRUE),
            `Indice de Tem. Hum. Viento mean` = mean(`Indice de Tem. Hum. Viento`, na.rm = TRUE),
            `Indice de Tem. Hum. Viento sd` = sd(`Indice de Tem. Hum. Viento`, na.rm = TRUE),
            `Presion Atmosfera (mm) mean` = mean(`Presion Atmosfera (mm)`, na.rm = TRUE),
            `Presion Atmosfera (mm) sd` = sd(`Presion Atmosfera (mm)`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) mean` = mean(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) sd` = sd(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Energia solar (w/m2) mean` = mean(`Energia solar (w/m2)`, na.rm = TRUE),
            `Energia solar (w/m2) sd` = sd(`Energia solar (w/m2)`, na.rm = TRUE),
            `Alta Radiacion sol. (w/m2) mean` = mean(`Alta Radiacion sol. (w/m2)`, na.rm = TRUE),
            `Alta Radiacion sol. (w/m2) sd` = sd(`Alta Radiacion sol. (w/m2)`, na.rm = TRUE),
            `Indice Rayos UV mean` = mean(`Indice Rayos UV`, na.rm = TRUE),
            `Indice Rayos UV sd` = sd(`Indice Rayos UV`, na.rm = TRUE),
            # # `Dosis UV mean` = mean(`Dosis UV`, na.rm = TRUE),
            # `Dosis UV sd` = sd(`Dosis UV`, na.rm = TRUE),
            `Alta Radiacion UV mean` = mean(`Alta Radiacion UV`, na.rm = TRUE),
            `Alta Radiacion UV sd` = sd(`Alta Radiacion UV`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) mean` = mean(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) sd` = sd(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Grados Calor (18.3 °C) sum` = sum(`Grados Calor (18.3 °C)`, na.rm = TRUE),
            `Grados Calor (18.3 °C) mean` = mean(`Grados Calor (18.3 °C)`, na.rm = TRUE),
            `Grados Calor (18.3 °C) sd` = sd(`Grados Calor (18.3 °C)`, na.rm = TRUE),
            `Grados Frio (18.3 °C) sum` = sum(`Grados Frio (18.3 °C)`, na.rm = TRUE),
            `Grados Frio (18.3 °C) mean` = mean(`Grados Frio (18.3 °C)`, na.rm = TRUE),
            `Grados Frio (18.3 °C) sd` = sd(`Grados Frio (18.3 °C)`, na.rm = TRUE),
            `Grados Calor (10 °C) sum` = sum(`Grados Calor (10 °C)`, na.rm = TRUE),
            `Grados Calor (10 °C) mean` = mean(`Grados Calor (10 °C)`, na.rm = TRUE),
            `Grados Calor (10 °C) sd` = sd(`Grados Calor (10 °C)`, na.rm = TRUE),
            `Grados Frio (10 °C) sum` = sum(`Grados Frio (10 °C)`, na.rm = TRUE),
            `Grados Frio (10 °C) mean` = mean(`Grados Frio (10 °C)`, na.rm = TRUE),
            `Grados Frio (10 °C) sd` = sd(`Grados Frio (10 °C)`, na.rm = TRUE),
            `Grados Calor (15 °C) sum` = sum(`Grados Calor (15 °C)`, na.rm = TRUE),
            `Grados Calor (15 °C) mean` = mean(`Grados Calor (15 °C)`, na.rm = TRUE),
            `Grados Calor (15 °C) sd` = sd(`Grados Calor (15 °C)`, na.rm = TRUE),
            `Grados Frio (15 °C) sum` = sum(`Grados Frio (15 °C)`, na.rm = TRUE),
            `Grados Frio (15 °C) mean` = mean(`Grados Frio (15 °C)`, na.rm = TRUE),
            `Grados Frio (15 °C) sd` = sd(`Grados Frio (15 °C)`, na.rm = TRUE),
            `Grados Calor (24 °C) sum` = sum(`Grados Calor (24 °C)`, na.rm = TRUE),
            `Grados Calor (24 °C) mean` = mean(`Grados Calor (24 °C)`, na.rm = TRUE),
            `Grados Calor (24 °C) sd` = sd(`Grados Calor (24 °C)`, na.rm = TRUE),
            `Grados Frio (24 °C) sum` = sum(`Grados Frio (24 °C)`, na.rm = TRUE),
            `Grados Frio (24 °C) mean` = mean(`Grados Frio (24 °C)`, na.rm = TRUE),
            `Grados Frio (24 °C) sd` = sd(`Grados Frio (24 °C)`, na.rm = TRUE),
            `Temp. Interna (°C) mean` = mean(`Temp. Interna (°C)`, na.rm = TRUE),
            `Temp. Interna (°C) sd` = sd(`Temp. Interna (°C)`, na.rm = TRUE),
            `Hum. Interna (%) mean` = mean(`Hum. Interna (%)`, na.rm = TRUE),
            `Hum. Interna (%) sd` = sd(`Hum. Interna (%)`, na.rm = TRUE),
            # `Rocio mean` = mean(`Rocio`, na.rm = TRUE),
            # `Rocio sd` = sd(`Rocio`, na.rm = TRUE),
            # `Calor mean` = mean(`Calor`, na.rm = TRUE),
            # `Calor sd` = sd(`Calor`, na.rm = TRUE),
            `Deficit de presion de vapor (DPV) sum` = sum(`Deficit de presion de vapor (DPV)`, na.rm = TRUE),
            `Deficit de presion de vapor (DPV) mean` = mean(`Deficit de presion de vapor (DPV)`, na.rm = TRUE),
            `Deficit de presion de vapor (DPV) sd` = sd(`Deficit de presion de vapor (DPV)`, na.rm = TRUE)
  ) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(Año = as.numeric(format(Date, format = "%Y")),
         Semana = as.numeric(format(Date, format = "%W"))) %>%
  dplyr::group_by(Año) %>%
  dplyr::mutate(`Horas Calor cumsum` = cumsum(`Horas Calor sum`),
                `Horas Frio cumsum` = cumsum(`Horas Frio sum`),
                `Horas Rocio cumsum` = cumsum(`Horas Rocio sum`),
                `Radiacion Solar (w/m2) cumsum` = cumsum(`Radiacion Solar (w/m2) mean`),
                `Dias Grado cumsum` = cumsum(`Dias Grado sum`),
                `Evapotranspiracion (mm) cumsum` = cumsum(`Evapotranspiracion (mm) sum`),
                `Lluvia (mm) cumsum` = cumsum(`Lluvia (mm) sum`),
                `Deficit de presion de vapor (DPV) cumsum` = cumsum(`Deficit de presion de vapor (DPV) sum`),
                `Diferencial termico` = `Temp. Maxima (°C) max` - 
                  `Temp. Minima (°C) min`,
                `Diferencial termico cumsum` = cumsum(`Diferencial termico`)) %>%
  dplyr::ungroup() %>%
  dplyr::filter(!Año == 2018)

write.csv(clima, "data_agromorin.csv", row.names = F)
```

### Temperatura

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Temp. Maxima (°C) max`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Temperatura (°C) máxima",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(18,34), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Temp. Media (°C) mean`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Temperatura (°C) media",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(15,28), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Temp. Minima (°C) min`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Temperatura (°C) mínima",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(10,24), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

### Diferencial térmico

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Diferencial termico`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Diferencial térmico (°C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,20), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

### Horas calor (>= 24 °C) y Horas frío (<= 15 °C)

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Calor sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Horas calor (>= 24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Frio sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Horas frío (<= 15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	


```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Horas Calor sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Horas Calor cumsum` = cumsum(`Horas Calor sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Calor cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Horas calor (>= 24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1300), breaks=0:100*100,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Frio cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Horas frío (<= 15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,900), breaks=0:100*100,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Horas rocío

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Rocio sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Horas rocío",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,16), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Horas Rocio sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Horas Rocio cumsum` = cumsum(`Horas Rocio sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Rocio cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Horas rocío",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,100), breaks=0:80*10,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	


### Radiación solar

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Radiacion Solar (w/m2) mean`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Radiación solar (W/m²)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "W/m²")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(200,1100), breaks=0:100*50,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Radiacion Solar (w/m2) mean`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Radiacion Solar (w/m2) cumsum` = cumsum(`Radiacion Solar (w/m2) mean`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Radiacion Solar (w/m2) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Radiación solar (W/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
   scale_y_continuous(limits = c(0,50000), breaks=0:100*5000,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	


### Grados de calor y frio {.tabset .tabset-fade .tabset-pills}

#### Base 10 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (10 °C)` = `Grados Calor (10 °C) sum`,
         `Grados frío (10 °C)` = `Grados Frio (10 °C) sum`) %>%
  select(Date,`Grados calor (10 °C)`,`Grados frío (10 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (10 °C)",
                                           "frío (10 °C)"),
                                labels = c("Grados calor (10 °C)",
                                           "Grados frío (10 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (10 °C) y Grados frío (10 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (10 °C)` = `Grados Calor (10 °C) sum`,
         `Grados frío (10 °C)` = `Grados Frio (10 °C) sum`) %>%
  select(Date,`Grados calor (10 °C)`,`Grados frío (10 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (10 °C)",
                                           "frío (10 °C)"),
                                labels = c("Grados calor (10 °C)",
                                           "Grados frío (10 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (10 °C)",
                                           "frío (10 °C)"),
                                labels = c("Grados calor (10 °C)",
                                           "Grados frío (10 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (10 °C) y Grados frío (10 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,4000), breaks=0:100*500,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```
#### Base 15 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (15 °C)` = `Grados Calor (15 °C) sum`,
         `Grados frío (15 °C)` = `Grados Frio (15 °C) sum`) %>%
  select(Date,`Grados calor (15 °C)`,`Grados frío (15 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (15 °C)",
                                           "frío (15 °C)"),
                                labels = c("Grados calor (15 °C)",
                                           "Grados frío (15 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (15 °C) y Grados frío (15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,100), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (15 °C)` = `Grados Calor (15 °C) sum`,
         `Grados frío (15 °C)` = `Grados Frio (15 °C) sum`) %>%
  select(Date,`Grados calor (15 °C)`,`Grados frío (15 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (15 °C)",
                                           "frío (15 °C)"),
                                labels = c("Grados calor (15 °C)",
                                           "Grados frío (15 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (15 °C)",
                                           "frío (15 °C)"),
                                labels = c("Grados calor (15 °C)",
                                           "Grados frío (15 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (15 °C) y Grados frío (15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,65), breaks=0:100*500,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```

#### Base 18.3 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (18.3 °C)` = `Grados Calor (18.3 °C) sum`,
         `Grados frío (18.3 °C)` = `Grados Frio (18.3 °C) sum`) %>%
  select(Date,`Grados calor (18.3 °C)`,`Grados frío (18.3 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (18.3 °C)",
                                           "frío (18.3 °C)"),
                                labels = c("Grados calor (18.3 °C)",
                                           "Grados frío (18.3 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (18.3 °C) y Grados frío (18.3 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,80), breaks=0:100*10,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (18.3 °C)` = `Grados Calor (18.3 °C) sum`,
         `Grados frío (18.3 °C)` = `Grados Frio (18.3 °C) sum`) %>%
  select(Date,`Grados calor (18.3 °C)`,`Grados frío (18.3 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (18.3 °C)",
                                           "frío (18.3 °C)"),
                                labels = c("Grados calor (18.3 °C)",
                                           "Grados frío (18.3 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (18.3 °C)",
                                           "frío (18.3 °C)"),
                                labels = c("Grados calor (18.3 °C)",
                                           "Grados frío (18.3 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (18.3 °C) y Grados frío (18.3 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1500), breaks=0:100*250,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```

#### Base 24 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (24 °C)` = `Grados Calor (24 °C) sum`,
         `Grados frío (24 °C)` = `Grados Frio (24 °C) sum`) %>%
  select(Date,`Grados calor (24 °C)`,`Grados frío (24 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (24 °C)",
                                           "frío (24 °C)"),
                                labels = c("Grados calor (24 °C)",
                                           "Grados frío (24 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (24 °C) y Grados frío (24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (24 °C)` = `Grados Calor (24 °C) sum`,
         `Grados frío (24 °C)` = `Grados Frio (24 °C) sum`) %>%
  select(Date,`Grados calor (24 °C)`,`Grados frío (24 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (24 °C)",
                                           "frío (24 °C)"),
                                labels = c("Grados calor (24 °C)",
                                           "Grados frío (24 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (24 °C)",
                                           "frío (24 °C)"),
                                labels = c("Grados calor (24 °C)",
                                           "Grados frío (24 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (24 °C) y Grados frío (24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,2000), breaks=0:100*250,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```

### Días grado {.tabset .tabset-fade .tabset-pills}

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Dias Grado sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Días Grado (°C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(30,130), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Dias Grado sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Dias Grado cumsum` = cumsum(`Dias Grado sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Dias Grado cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Días Grado (°C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,4500), breaks=0:100*500,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Humedad relativa

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Humedad Externa (%) mean`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Humedad relativa (%)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "%")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(30,100), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

### Evapotranspiración

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Evapotranspiracion (mm) sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Evapotranspiración (mm/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m²")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,45), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Evapotranspiracion (mm) sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Evapotranspiracion (mm) cumsum` = cumsum(`Evapotranspiracion (mm) sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Evapotranspiracion (mm) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Evapotranspiración (mm/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m² acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1100), breaks=0:100*50,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Precipitación pluvial

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Lluvia (mm) sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Precipitación pluvial (mm/m²)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m²")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,5), breaks=0:100*1,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Lluvia (mm) sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Lluvia (mm) cumsum` = cumsum(`Lluvia (mm) sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Lluvia (mm) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Precipitación pluvial (mm/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m² acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,25), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Déficit de presión de vapor

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Deficit de presion de vapor (DPV) sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Déficit de presión de vapor (DPV)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "KPa")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,80), breaks=0:100*10,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Deficit de presion de vapor (DPV) sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Deficit de presion de vapor (DPV) cumsum` = cumsum(`Deficit de presion de vapor (DPV) sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Deficit de presion de vapor (DPV) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Déficit de presión de vapor (DPV)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "KPa acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1000), breaks=0:100*50,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

## Fundo Santo Domingo {.tabset .tabset-fade .tabset-pills}

```{r,echo=FALSE,comment=NA, warning=FALSE,message=FALSE}
all_na <- function(x) any(!is.na(x))
spaceless <- function(x) {colnames(x) <- gsub(c("\\s\\s"), " ", colnames(x));x}

datos_clima <- readxl::read_excel("Datos clima 2.xlsx",sheet = "Santo Domingo")
clima_pre <- datos_clima %>%
  mutate(#Semana = isoweek(Date),
    Fecha = ceiling_date(Date, "week"),
    Semana = isoweek(Fecha),
    Date = as.Date(Date, format = "%Y%m%d"),
    `Temp. Media (°C)` = (`Temp. Maxima (°C)`+`Temp. Minima (°C)`)/2#,
    #Año_corregido = year(ceiling_date(Date, "week")),
    #DiadelAño = as.numeric(format(Date, format = "%j")),
    #DiadelMes = as.numeric(format(Date, format = "%d")),
    #DiadelaSemana = as.numeric(format(Date, format = "%u")),
    #MesdelAño = as.numeric(format(Date, format = "%m"))
  ) %>%
  dplyr::select_if(all_na)%>%
  # janitor::clean_names()
  spaceless() %>%
  dplyr::mutate(Time = round(Time*24,0),
                Date2 = if_else(Time != 0, Date, Date-1),
                DiadelAño = as.numeric(format(Date2, format = "%j")),
                DiadelMes = as.numeric(format(Date2, format = "%d")),
                DiadelaSemana = as.numeric(format(Date2, format = "%u")),
                Año = lubridate::year(Date))

# clima_means <- clima_pre %>%
#   dplyr::filter(is.na(Time)) %>%
#   dplyr::select(Date,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
#                 `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
#                 `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
#                 `Factor enfria por Viento (°C)`,`Indice de Calor`,
#                 `Indice de Tem. Hum. Viento`,
#                 `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
#                 `Grados Caloricos dia (°C)`,
#                 `Grados Frio (°C)`, `Temp. Interna (°C)`,
#                 `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
#                 `Evapotranspiracion (mm)`,`Lluvia (mm)`,`Temp. Maxima (°C)`,
#                 `Temp. Minima (°C)`,`Temp. Media (°C) mean (°C)`,`Radiacion Solar (w/m2)`,
#                 `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
#                 `Indice Rayos UV`, `Dosis UV`, `Alta Radiacion UV`)

clima_means <- clima_pre %>%
  dplyr::group_by(Date2) %>%
  dplyr::summarise_if(is.numeric, mean, na.rm = TRUE) %>%
  dplyr::ungroup() %>%
  dplyr::select(Date2,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
                `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
                `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
                `Factor enfria por Viento (°C)`,`Indice de Calor`,
                `Indice de Tem. Hum. Viento`,
                `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
                `Temp. Interna (°C)`,
                `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
                #`Evapotranspiracion (mm)`,`Lluvia (mm)`,
                # `Temp. Maxima (°C)`,
                # `Temp. Minima (°C)`,`Temp. Media (°C)`,`Radiacion Solar (w/m2)`,
                `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
                `Indice Rayos UV`, # `Dosis UV`,
                `Alta Radiacion UV`) %>%
  dplyr::rename(Date = Date2)

# colnames(clima_means)[-1] <- paste(colnames(clima_means)[-1], "mean", sep = " ")

# clima_max <- clima_pre %>%
#   dplyr::group_by(Date2) %>%
#   dplyr::summarise_if(is.numeric, max, na.rm = TRUE) %>%
#   dplyr::ungroup() %>%
#   dplyr::select(Date2,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
#                 `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
#                 `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
#                 `Factor enfria por Viento (°C)`,`Indice de Calor`,
#                 `Indice de Tem. Hum. Viento`,
#                 `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
#                 `Grados Caloricos dia (°C)`,
#                 `Grados Frio (°C)`, `Temp. Interna (°C)`,
#                 `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
#                 `Evapotranspiracion (mm)`,`Lluvia (mm)`,`Temp. Maxima (°C)`,
#                 `Temp. Minima (°C)`,`Temp. Media (°C)`,`Radiacion Solar (w/m2)`,
#                 `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
#                 `Indice Rayos UV`, `Dosis UV`, `Alta Radiacion UV`) %>%
#   dplyr::rename(Date = Date2)
# colnames(clima_max)[-1] <- paste(colnames(clima_max)[-1], "max", sep = " ")
# 
# clima_min <- clima_pre %>%
#   dplyr::group_by(Date2) %>%
#   dplyr::summarise_if(is.numeric, min, na.rm = TRUE) %>%
#   dplyr::ungroup() %>%
#   dplyr::select(Date2,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
#                 `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
#                 `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
#                 `Factor enfria por Viento (°C)`,`Indice de Calor`,
#                 `Indice de Tem. Hum. Viento`,
#                 `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
#                 `Grados Caloricos dia (°C)`,
#                 `Grados Frio (°C)`, `Temp. Interna (°C)`,
#                 `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
#                 `Evapotranspiracion (mm)`,`Lluvia (mm)`,`Temp. Maxima (°C)`,
#                 `Temp. Minima (°C)`,`Temp. Media (°C)`,`Radiacion Solar (w/m2)`,
#                 `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
#                 `Indice Rayos UV`, `Dosis UV`, `Alta Radiacion UV`) %>%
#   dplyr::rename(Date = Date2)
# colnames(clima_min)[-1] <- paste(colnames(clima_min)[-1], "min", sep = " ")

clima_horas <- clima_pre %>%
  dplyr::filter(!is.na(Time)) %>%
  #recipes::step_nzv(all_predictors()) %>%
  dplyr::group_by(Date2,Time) %>%
  dplyr::summarise(`Temp. Maxima (°C)` = max(`Temp. Maxima (°C)`,na.rm = TRUE),
                   `Temp. Minima (°C)` = min(`Temp. Minima (°C)`,na.rm = TRUE),
                   #`Temp. Media (°C)` = (`Temp. Maxima (°C)`+`Temp. Minima (°C)`)/2,
                   `Dias Grado` = (`Temp. Exterior (°C)` - 10)/24,
                   `Dias Grado` = ifelse(`Dias Grado` < 0, 0, `Dias Grado`),
                   `Horas Rocio` = sum(`Horas Rocio`, na.rm = TRUE)) %>%
  dplyr::ungroup() %>%
  dplyr::group_by(Date2) %>%
  dplyr::summarise(`Horas Calor` = sum(`Temp. Minima (°C)`>=24, na.rm = TRUE)/n()*24,
                   `Horas Frio` = sum(`Temp. Maxima (°C)`<=15, na.rm = TRUE)/n()*24,
                   `Dias Grado` = sum(`Dias Grado`)/n()*24,
                   `Dias Grado` = ifelse(`Dias Grado` < 0, 0, `Dias Grado`),
                   `Horas Rocio` = sum(`Horas Rocio`)/n()*24,
                   `Horas Rocio` = ifelse(`Horas Rocio` < 0, 0, `Horas Rocio`)) %>%
  dplyr::ungroup() %>%
  dplyr::rename(Date = Date2) %>%
  tidyr::replace_na(list(`Dias Grado` = 0,
                         `Horas Rocio` = 0))

clima_temp <- clima_pre %>%
  dplyr::filter(!is.na(Time)) %>%
  #recipes::step_nzv(all_predictors()) %>%
  dplyr::group_by(Date2) %>%
  dplyr::summarise(`Temp. Maxima (°C)` = max(`Temp. Maxima (°C)`,na.rm = TRUE),
                   `Temp. Minima (°C)` = min(`Temp. Minima (°C)`,na.rm = TRUE),
                   `Temp. Media (°C)` = (`Temp. Maxima (°C)`+`Temp. Minima (°C)`)/2,
                   `Radiacion Solar (w/m2)` = max(`Radiacion Solar (w/m2)`, na.rm = TRUE),
                   `Evapotranspiracion (mm)` = sum(`Evapotranspiracion (mm)`, na.rm = TRUE),
                   `Lluvia (mm)` = sum(`Lluvia (mm)`, na.rm = TRUE),
                   `Deficit de presion de vapor (DPV)` = mean(`DPVfinal`, na.rm = TRUE),
                   `Grados Calor (18.3 °C)` = sum(`GC`, na.rm = TRUE),
                   `Grados Frio (18.3 °C)` = sum(`GF`, na.rm = TRUE), 
                   `Grados Calor (10 °C)` = sum(`GC10`, na.rm = TRUE),
                   `Grados Frio (10 °C)` = sum(`GF10`, na.rm = TRUE), 
                   `Grados Calor (15 °C)` = sum(`GC15`, na.rm = TRUE),
                   `Grados Frio (15 °C)` = sum(`GF15`, na.rm = TRUE), 
                   `Grados Calor (24 °C)` = sum(`GC24`, na.rm = TRUE),
                   `Grados Frio (24 °C)` = sum(`GF24`, na.rm = TRUE)) %>%
  dplyr::ungroup() %>%
  dplyr::rename(Date = Date2)

clima_dia <- clima_means %>%
  left_join(clima_temp, by = c("Date")) %>%
  left_join(clima_horas, by = c("Date"))

clima <- clima_dia %>%
  mutate(Date = ceiling_date(Date, "week")) %>%
  group_by(Date) %>%
  summarise(`Temp. Maxima (°C) max` = max(`Temp. Maxima (°C)`,na.rm = TRUE),
            `Temp. Maxima (°C) mean` = mean(`Temp. Maxima (°C)`,na.rm = TRUE),
            `Temp. Maxima (°C) sd` = sd(`Temp. Maxima (°C)`,na.rm = TRUE),
            `Temp. Minima (°C) min` = min(`Temp. Minima (°C)`,na.rm = TRUE),
            `Temp. Minima (°C) mean` = mean(`Temp. Minima (°C)`,na.rm = TRUE),
            `Temp. Minima (°C) sd` = sd(`Temp. Minima (°C)`,na.rm = TRUE),
            `Temp. Media (°C) mean` = mean(`Temp. Media (°C)`,na.rm = TRUE),
            `Temp. Media (°C) sd` = sd(`Temp. Media (°C)`,na.rm = TRUE),
            `Temp. Exterior (°C) mean` = mean(`Temp. Exterior (°C)`,na.rm = TRUE),
            `Temp. Exterior (°C) sd` = sd(`Temp. Exterior (°C)`,na.rm = TRUE),
            `Humedad Externa (%) mean` = mean(`Humedad Externa (%)`,na.rm = TRUE),
            `Humedad Externa (%) sd` = sd(`Humedad Externa (%)`,na.rm = TRUE),
            `Horas Calor sum` = sum(`Horas Calor`, na.rm = TRUE),
            `Horas Calor sd` = sd(`Horas Calor`, na.rm = TRUE),
            `Horas Frio sum` = sum(`Horas Frio`, na.rm = TRUE),
            `Horas Frio sd` = sd(`Horas Frio`, na.rm = TRUE),
            `Dias Grado sum` = sum(`Dias Grado`, na.rm = TRUE),
            `Dias Grado sd` = sd(`Dias Grado`, na.rm = TRUE),
            `Horas Rocio sum` = sum(`Horas Rocio`, na.rm = TRUE),
            `Horas Rocio sd` = sd(`Horas Rocio`, na.rm = TRUE),
            `Lluvia (mm) sum` = sum(`Lluvia (mm)`, na.rm = TRUE),
            `Lluvia (mm) mean` = mean(`Lluvia (mm)`, na.rm = TRUE),
            `Lluvia (mm) sd` = sd(`Lluvia (mm)`, na.rm = TRUE),
            `Radiacion Solar (w/m2) mean` = mean(`Radiacion Solar (w/m2)`, na.rm = TRUE),
            `Radiacion Solar (w/m2) sd` = sd(`Radiacion Solar (w/m2)`, na.rm = TRUE),
            `Evapotranspiracion (mm) sum` = sum(`Evapotranspiracion (mm)`, na.rm = TRUE),
            `Evapotranspiracion (mm) mean` = mean(`Evapotranspiracion (mm)`, na.rm = TRUE),
            `Evapotranspiracion (mm) sd` = sd(`Evapotranspiracion (mm)`, na.rm = TRUE),
            `Punto Rocio (°C) mean` = mean(`Punto Rocio (°C)`, na.rm = TRUE),
            `Punto Rocio (°C) sd` = sd(`Punto Rocio (°C)`, na.rm = TRUE),
            `Vel. Min Viento (km/hr) mean` = mean(`Vel. Min Viento (km/hr)`, na.rm = TRUE),
            `Vel. Min Viento (km/hr) sd` = sd(`Vel. Min Viento (km/hr)`, na.rm = TRUE),
            `Viento Durante un Intervalo mean` = mean(`Viento Durante un Intervalo`, na.rm = TRUE),
            `Viento Durante un Intervalo sd` = sd(`Viento Durante un Intervalo`, na.rm = TRUE),
            `Velocida Max (km/hr) mean` = mean(`Velocida Max (km/hr)`, na.rm = TRUE),
            `Velocida Max (km/hr) sd` = sd(`Velocida Max (km/hr)`, na.rm = TRUE),
            `Factor enfria por Viento (°C) mean` = mean(`Factor enfria por Viento (°C)`, na.rm = TRUE),
            `Factor enfria por Viento (°C) sd` = sd(`Factor enfria por Viento (°C)`, na.rm = TRUE),
            `Indice de Calor mean` = mean(`Indice de Calor`, na.rm = TRUE),
            `Indice de Calor sd` = sd(`Indice de Calor`, na.rm = TRUE),
            `Indice de Tem. Hum. Viento mean` = mean(`Indice de Tem. Hum. Viento`, na.rm = TRUE),
            `Indice de Tem. Hum. Viento sd` = sd(`Indice de Tem. Hum. Viento`, na.rm = TRUE),
            `Presion Atmosfera (mm) mean` = mean(`Presion Atmosfera (mm)`, na.rm = TRUE),
            `Presion Atmosfera (mm) sd` = sd(`Presion Atmosfera (mm)`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) mean` = mean(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) sd` = sd(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Energia solar (w/m2) mean` = mean(`Energia solar (w/m2)`, na.rm = TRUE),
            `Energia solar (w/m2) sd` = sd(`Energia solar (w/m2)`, na.rm = TRUE),
            `Alta Radiacion sol. (w/m2) mean` = mean(`Alta Radiacion sol. (w/m2)`, na.rm = TRUE),
            `Alta Radiacion sol. (w/m2) sd` = sd(`Alta Radiacion sol. (w/m2)`, na.rm = TRUE),
            `Indice Rayos UV mean` = mean(`Indice Rayos UV`, na.rm = TRUE),
            `Indice Rayos UV sd` = sd(`Indice Rayos UV`, na.rm = TRUE),
            # # `Dosis UV mean` = mean(`Dosis UV`, na.rm = TRUE),
            # `Dosis UV sd` = sd(`Dosis UV`, na.rm = TRUE),
            `Alta Radiacion UV mean` = mean(`Alta Radiacion UV`, na.rm = TRUE),
            `Alta Radiacion UV sd` = sd(`Alta Radiacion UV`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) mean` = mean(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) sd` = sd(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Grados Calor (18.3 °C) sum` = sum(`Grados Calor (18.3 °C)`, na.rm = TRUE),
            `Grados Calor (18.3 °C) mean` = mean(`Grados Calor (18.3 °C)`, na.rm = TRUE),
            `Grados Calor (18.3 °C) sd` = sd(`Grados Calor (18.3 °C)`, na.rm = TRUE),
            `Grados Frio (18.3 °C) sum` = sum(`Grados Frio (18.3 °C)`, na.rm = TRUE),
            `Grados Frio (18.3 °C) mean` = mean(`Grados Frio (18.3 °C)`, na.rm = TRUE),
            `Grados Frio (18.3 °C) sd` = sd(`Grados Frio (18.3 °C)`, na.rm = TRUE),
            `Grados Calor (10 °C) sum` = sum(`Grados Calor (10 °C)`, na.rm = TRUE),
            `Grados Calor (10 °C) mean` = mean(`Grados Calor (10 °C)`, na.rm = TRUE),
            `Grados Calor (10 °C) sd` = sd(`Grados Calor (10 °C)`, na.rm = TRUE),
            `Grados Frio (10 °C) sum` = sum(`Grados Frio (10 °C)`, na.rm = TRUE),
            `Grados Frio (10 °C) mean` = mean(`Grados Frio (10 °C)`, na.rm = TRUE),
            `Grados Frio (10 °C) sd` = sd(`Grados Frio (10 °C)`, na.rm = TRUE),
            `Grados Calor (15 °C) sum` = sum(`Grados Calor (15 °C)`, na.rm = TRUE),
            `Grados Calor (15 °C) mean` = mean(`Grados Calor (15 °C)`, na.rm = TRUE),
            `Grados Calor (15 °C) sd` = sd(`Grados Calor (15 °C)`, na.rm = TRUE),
            `Grados Frio (15 °C) sum` = sum(`Grados Frio (15 °C)`, na.rm = TRUE),
            `Grados Frio (15 °C) mean` = mean(`Grados Frio (15 °C)`, na.rm = TRUE),
            `Grados Frio (15 °C) sd` = sd(`Grados Frio (15 °C)`, na.rm = TRUE),
            `Grados Calor (24 °C) sum` = sum(`Grados Calor (24 °C)`, na.rm = TRUE),
            `Grados Calor (24 °C) mean` = mean(`Grados Calor (24 °C)`, na.rm = TRUE),
            `Grados Calor (24 °C) sd` = sd(`Grados Calor (24 °C)`, na.rm = TRUE),
            `Grados Frio (24 °C) sum` = sum(`Grados Frio (24 °C)`, na.rm = TRUE),
            `Grados Frio (24 °C) mean` = mean(`Grados Frio (24 °C)`, na.rm = TRUE),
            `Grados Frio (24 °C) sd` = sd(`Grados Frio (24 °C)`, na.rm = TRUE),
            `Temp. Interna (°C) mean` = mean(`Temp. Interna (°C)`, na.rm = TRUE),
            `Temp. Interna (°C) sd` = sd(`Temp. Interna (°C)`, na.rm = TRUE),
            `Hum. Interna (%) mean` = mean(`Hum. Interna (%)`, na.rm = TRUE),
            `Hum. Interna (%) sd` = sd(`Hum. Interna (%)`, na.rm = TRUE),
            # `Rocio mean` = mean(`Rocio`, na.rm = TRUE),
            # `Rocio sd` = sd(`Rocio`, na.rm = TRUE),
            # `Calor mean` = mean(`Calor`, na.rm = TRUE),
            # `Calor sd` = sd(`Calor`, na.rm = TRUE),
            `Deficit de presion de vapor (DPV) sum` = sum(`Deficit de presion de vapor (DPV)`, na.rm = TRUE),
            `Deficit de presion de vapor (DPV) mean` = mean(`Deficit de presion de vapor (DPV)`, na.rm = TRUE),
            `Deficit de presion de vapor (DPV) sd` = sd(`Deficit de presion de vapor (DPV)`, na.rm = TRUE)
  ) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(Año = as.numeric(format(Date, format = "%Y")),
         Semana = as.numeric(format(Date, format = "%W"))) %>%
  dplyr::group_by(Año) %>%
  dplyr::mutate(`Horas Calor cumsum` = cumsum(`Horas Calor sum`),
                `Horas Frio cumsum` = cumsum(`Horas Frio sum`),
                `Horas Rocio cumsum` = cumsum(`Horas Rocio sum`),
                `Radiacion Solar (w/m2) cumsum` = cumsum(`Radiacion Solar (w/m2) mean`),
                `Dias Grado cumsum` = cumsum(`Dias Grado sum`),
                `Evapotranspiracion (mm) cumsum` = cumsum(`Evapotranspiracion (mm) sum`),
                `Lluvia (mm) cumsum` = cumsum(`Lluvia (mm) sum`),
                `Deficit de presion de vapor (DPV) cumsum` = cumsum(`Deficit de presion de vapor (DPV) sum`),
                `Diferencial termico` = `Temp. Maxima (°C) max` - 
                  `Temp. Minima (°C) min`,
                `Diferencial termico cumsum` = cumsum(`Diferencial termico`)) %>%
  dplyr::ungroup() %>%
  dplyr::filter(!Año == 2018)

write.csv(clima, "data_santodomingo.csv", row.names = F)
```

### Temperatura

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Temp. Maxima (°C) max`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Temperatura (°C) máxima",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(18,34), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Temp. Media (°C) mean`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Temperatura (°C) media",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(15,28), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Temp. Minima (°C) min`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Temperatura (°C) mínima",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(10,24), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

### Diferencial térmico

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Diferencial termico`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Diferencial térmico (°C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,20), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

### Horas calor (>= 24 °C) y Horas frío (<= 15 °C)

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Calor sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Horas calor (>= 24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,150), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Frio sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Horas frío (<= 15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	


```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Horas Calor sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Horas Calor cumsum` = cumsum(`Horas Calor sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Calor cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Horas calor (>= 24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1600), breaks=0:100*100,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Frio cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Horas frío (<= 15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,900), breaks=0:100*100,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Horas rocío

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Rocio sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Horas rocío",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,10), breaks=0:100*1,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Horas Rocio sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Horas Rocio cumsum` = cumsum(`Horas Rocio sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Rocio cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Horas rocío",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,20), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Radiación solar

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Radiacion Solar (w/m2) mean`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Radiación solar (W/m²)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "W/m²")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(200,1100), breaks=0:100*50,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Radiacion Solar (w/m2) mean`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Radiacion Solar (w/m2) cumsum` = cumsum(`Radiacion Solar (w/m2) mean`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Radiacion Solar (w/m2) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Radiación solar (W/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
   scale_y_continuous(limits = c(0,50000), breaks=0:100*5000,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	


### Grados de calor y frio {.tabset .tabset-fade .tabset-pills}

#### Base 10 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (10 °C)` = `Grados Calor (10 °C) sum`,
         `Grados frío (10 °C)` = `Grados Frio (10 °C) sum`) %>%
  select(Date,`Grados calor (10 °C)`,`Grados frío (10 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (10 °C)",
                                           "frío (10 °C)"),
                                labels = c("Grados calor (10 °C)",
                                           "Grados frío (10 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (10 °C) y Grados frío (10 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (10 °C)` = `Grados Calor (10 °C) sum`,
         `Grados frío (10 °C)` = `Grados Frio (10 °C) sum`) %>%
  select(Date,`Grados calor (10 °C)`,`Grados frío (10 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (10 °C)",
                                           "frío (10 °C)"),
                                labels = c("Grados calor (10 °C)",
                                           "Grados frío (10 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (10 °C)",
                                           "frío (10 °C)"),
                                labels = c("Grados calor (10 °C)",
                                           "Grados frío (10 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (10 °C) y Grados frío (10 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,4000), breaks=0:100*500,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```

#### Base 15 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (15 °C)` = `Grados Calor (15 °C) sum`,
         `Grados frío (15 °C)` = `Grados Frio (15 °C) sum`) %>%
  select(Date,`Grados calor (15 °C)`,`Grados frío (15 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (15 °C)",
                                           "frío (15 °C)"),
                                labels = c("Grados calor (15 °C)",
                                           "Grados frío (15 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (15 °C) y Grados frío (15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,100), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (15 °C)` = `Grados Calor (15 °C) sum`,
         `Grados frío (15 °C)` = `Grados Frio (15 °C) sum`) %>%
  select(Date,`Grados calor (15 °C)`,`Grados frío (15 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (15 °C)",
                                           "frío (15 °C)"),
                                labels = c("Grados calor (15 °C)",
                                           "Grados frío (15 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (15 °C)",
                                           "frío (15 °C)"),
                                labels = c("Grados calor (15 °C)",
                                           "Grados frío (15 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (15 °C) y Grados frío (15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,65), breaks=0:100*500,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```

#### Base 18.3 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (18.3 °C)` = `Grados Calor (18.3 °C) sum`,
         `Grados frío (18.3 °C)` = `Grados Frio (18.3 °C) sum`) %>%
  select(Date,`Grados calor (18.3 °C)`,`Grados frío (18.3 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (18.3 °C)",
                                           "frío (18.3 °C)"),
                                labels = c("Grados calor (18.3 °C)",
                                           "Grados frío (18.3 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (18.3 °C) y Grados frío (18.3 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,80), breaks=0:100*10,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (18.3 °C)` = `Grados Calor (18.3 °C) sum`,
         `Grados frío (18.3 °C)` = `Grados Frio (18.3 °C) sum`) %>%
  select(Date,`Grados calor (18.3 °C)`,`Grados frío (18.3 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (18.3 °C)",
                                           "frío (18.3 °C)"),
                                labels = c("Grados calor (18.3 °C)",
                                           "Grados frío (18.3 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (18.3 °C)",
                                           "frío (18.3 °C)"),
                                labels = c("Grados calor (18.3 °C)",
                                           "Grados frío (18.3 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (18.3 °C) y Grados frío (18.3 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1500), breaks=0:100*250,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```

#### Base 24 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (24 °C)` = `Grados Calor (24 °C) sum`,
         `Grados frío (24 °C)` = `Grados Frio (24 °C) sum`) %>%
  select(Date,`Grados calor (24 °C)`,`Grados frío (24 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (24 °C)",
                                           "frío (24 °C)"),
                                labels = c("Grados calor (24 °C)",
                                           "Grados frío (24 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (24 °C) y Grados frío (24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (24 °C)` = `Grados Calor (24 °C) sum`,
         `Grados frío (24 °C)` = `Grados Frio (24 °C) sum`) %>%
  select(Date,`Grados calor (24 °C)`,`Grados frío (24 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (24 °C)",
                                           "frío (24 °C)"),
                                labels = c("Grados calor (24 °C)",
                                           "Grados frío (24 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (24 °C)",
                                           "frío (24 °C)"),
                                labels = c("Grados calor (24 °C)",
                                           "Grados frío (24 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (24 °C) y Grados frío (24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,2000), breaks=0:100*250,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```

### Días grado {.tabset .tabset-fade .tabset-pills}

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Dias Grado sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Días Grado (°C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(30,130), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Dias Grado sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Dias Grado cumsum` = cumsum(`Dias Grado sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Dias Grado cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Días Grado (°C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,4500), breaks=0:100*500,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Humedad relativa

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Humedad Externa (%) mean`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Humedad relativa (%)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "%")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(70,100), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

### Evapotranspiración

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Evapotranspiracion (mm) sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Evapotranspiración (mm/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m²")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,45), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Evapotranspiracion (mm) sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Evapotranspiracion (mm) cumsum` = cumsum(`Evapotranspiracion (mm) sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Evapotranspiracion (mm) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Evapotranspiración (mm/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m² acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1100), breaks=0:100*50,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Precipitación pluvial

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Lluvia (mm) sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Precipitación pluvial (mm/m²)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m²")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,5), breaks=0:100*1,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Lluvia (mm) sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Lluvia (mm) cumsum` = cumsum(`Lluvia (mm) sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Lluvia (mm) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Precipitación pluvial (mm/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m² acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,25), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Déficit de presión de vapor

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Deficit de presion de vapor (DPV) sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Déficit de presión de vapor (DPV)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "KPa")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,30), breaks=0:100*10,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Deficit de presion de vapor (DPV) sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Deficit de presion de vapor (DPV) cumsum` = cumsum(`Deficit de presion de vapor (DPV) sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Deficit de presion de vapor (DPV) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Déficit de presión de vapor (DPV)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "KPa acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1000), breaks=0:100*50,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

## Fundo Victoria {.tabset .tabset-fade .tabset-pills}

```{r,echo=FALSE,comment=NA, warning=FALSE,message=FALSE}
all_na <- function(x) any(!is.na(x))
spaceless <- function(x) {colnames(x) <- gsub(c("\\s\\s"), " ", colnames(x));x}

datos_clima <- readxl::read_excel("Datos clima 2.xlsx",sheet = "Victoria")
clima_pre <- datos_clima %>%
  mutate(#Semana = isoweek(Date),
    Fecha = ceiling_date(Date, "week"),
    Semana = isoweek(Fecha),
    Date = as.Date(Date, format = "%Y%m%d"),
    `Temp. Media (°C)` = (`Temp. Maxima (°C)`+`Temp. Minima (°C)`)/2#,
    #Año_corregido = year(ceiling_date(Date, "week")),
    #DiadelAño = as.numeric(format(Date, format = "%j")),
    #DiadelMes = as.numeric(format(Date, format = "%d")),
    #DiadelaSemana = as.numeric(format(Date, format = "%u")),
    #MesdelAño = as.numeric(format(Date, format = "%m"))
  ) %>%
  dplyr::select_if(all_na)%>%
  # janitor::clean_names()
  spaceless() %>%
  dplyr::mutate(Time = round(Time*24,0),
                Date2 = if_else(Time != 0, Date, Date-1),
                DiadelAño = as.numeric(format(Date2, format = "%j")),
                DiadelMes = as.numeric(format(Date2, format = "%d")),
                DiadelaSemana = as.numeric(format(Date2, format = "%u")),
                Año = lubridate::year(Date))

# clima_means <- clima_pre %>%
#   dplyr::filter(is.na(Time)) %>%
#   dplyr::select(Date,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
#                 `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
#                 `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
#                 `Factor enfria por Viento (°C)`,`Indice de Calor`,
#                 `Indice de Tem. Hum. Viento`,
#                 `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
#                 `Grados Caloricos dia (°C)`,
#                 `Grados Frio (°C)`, `Temp. Interna (°C)`,
#                 `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
#                 `Evapotranspiracion (mm)`,`Lluvia (mm)`,`Temp. Maxima (°C)`,
#                 `Temp. Minima (°C)`,`Temp. Media (°C) mean (°C)`,`Radiacion Solar (w/m2)`,
#                 `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
#                 `Indice Rayos UV`, `Dosis UV`, `Alta Radiacion UV`)

clima_means <- clima_pre %>%
  dplyr::group_by(Date2) %>%
  dplyr::summarise_if(is.numeric, mean, na.rm = TRUE) %>%
  dplyr::ungroup() %>%
  dplyr::select(Date2,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
                `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
                `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
                `Factor enfria por Viento (°C)`,`Indice de Calor`,
                `Indice de Tem. Hum. Viento`,
                `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
                `Temp. Interna (°C)`,
                `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
                #`Evapotranspiracion (mm)`,`Lluvia (mm)`,
                # `Temp. Maxima (°C)`,
                # `Temp. Minima (°C)`,`Temp. Media (°C)`,`Radiacion Solar (w/m2)`,
                `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
                `Indice Rayos UV`, # `Dosis UV`,
                `Alta Radiacion UV`) %>%
  dplyr::rename(Date = Date2)

# colnames(clima_means)[-1] <- paste(colnames(clima_means)[-1], "mean", sep = " ")

# clima_max <- clima_pre %>%
#   dplyr::group_by(Date2) %>%
#   dplyr::summarise_if(is.numeric, max, na.rm = TRUE) %>%
#   dplyr::ungroup() %>%
#   dplyr::select(Date2,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
#                 `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
#                 `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
#                 `Factor enfria por Viento (°C)`,`Indice de Calor`,
#                 `Indice de Tem. Hum. Viento`,
#                 `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
#                 `Grados Caloricos dia (°C)`,
#                 `Grados Frio (°C)`, `Temp. Interna (°C)`,
#                 `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
#                 `Evapotranspiracion (mm)`,`Lluvia (mm)`,`Temp. Maxima (°C)`,
#                 `Temp. Minima (°C)`,`Temp. Media (°C)`,`Radiacion Solar (w/m2)`,
#                 `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
#                 `Indice Rayos UV`, `Dosis UV`, `Alta Radiacion UV`) %>%
#   dplyr::rename(Date = Date2)
# colnames(clima_max)[-1] <- paste(colnames(clima_max)[-1], "max", sep = " ")
# 
# clima_min <- clima_pre %>%
#   dplyr::group_by(Date2) %>%
#   dplyr::summarise_if(is.numeric, min, na.rm = TRUE) %>%
#   dplyr::ungroup() %>%
#   dplyr::select(Date2,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
#                 `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
#                 `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
#                 `Factor enfria por Viento (°C)`,`Indice de Calor`,
#                 `Indice de Tem. Hum. Viento`,
#                 `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
#                 `Grados Caloricos dia (°C)`,
#                 `Grados Frio (°C)`, `Temp. Interna (°C)`,
#                 `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
#                 `Evapotranspiracion (mm)`,`Lluvia (mm)`,`Temp. Maxima (°C)`,
#                 `Temp. Minima (°C)`,`Temp. Media (°C)`,`Radiacion Solar (w/m2)`,
#                 `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
#                 `Indice Rayos UV`, `Dosis UV`, `Alta Radiacion UV`) %>%
#   dplyr::rename(Date = Date2)
# colnames(clima_min)[-1] <- paste(colnames(clima_min)[-1], "min", sep = " ")

clima_horas <- clima_pre %>%
  dplyr::filter(!is.na(Time)) %>%
  #recipes::step_nzv(all_predictors()) %>%
  dplyr::group_by(Date2,Time) %>%
  dplyr::summarise(`Temp. Maxima (°C)` = max(`Temp. Maxima (°C)`,na.rm = TRUE),
                   `Temp. Minima (°C)` = min(`Temp. Minima (°C)`,na.rm = TRUE),
                   #`Temp. Media (°C)` = (`Temp. Maxima (°C)`+`Temp. Minima (°C)`)/2,
                   `Dias Grado` = (`Temp. Exterior (°C)` - 10)/24,
                   `Dias Grado` = ifelse(`Dias Grado` < 0, 0, `Dias Grado`),
                   `Horas Rocio` = sum(`Horas Rocio`, na.rm = TRUE)) %>%
  dplyr::ungroup() %>%
  dplyr::group_by(Date2) %>%
  dplyr::summarise(`Horas Calor` = sum(`Temp. Minima (°C)`>=24, na.rm = TRUE)/n()*24,
                   `Horas Frio` = sum(`Temp. Maxima (°C)`<=15, na.rm = TRUE)/n()*24,
                   `Dias Grado` = sum(`Dias Grado`)/n()*24,
                   `Dias Grado` = ifelse(`Dias Grado` < 0, 0, `Dias Grado`),
                   `Horas Rocio` = sum(`Horas Rocio`)/n()*24,
                   `Horas Rocio` = ifelse(`Horas Rocio` < 0, 0, `Horas Rocio`)) %>%
  dplyr::ungroup() %>%
  dplyr::rename(Date = Date2) %>%
  tidyr::replace_na(list(`Dias Grado` = 0,
                         `Horas Rocio` = 0))

clima_temp <- clima_pre %>%
  dplyr::filter(!is.na(Time)) %>%
  #recipes::step_nzv(all_predictors()) %>%
  dplyr::group_by(Date2) %>%
  dplyr::summarise(`Temp. Maxima (°C)` = max(`Temp. Maxima (°C)`,na.rm = TRUE),
                   `Temp. Minima (°C)` = min(`Temp. Minima (°C)`,na.rm = TRUE),
                   `Temp. Media (°C)` = (`Temp. Maxima (°C)`+`Temp. Minima (°C)`)/2,
                   `Radiacion Solar (w/m2)` = max(`Radiacion Solar (w/m2)`, na.rm = TRUE),
                   `Evapotranspiracion (mm)` = sum(`Evapotranspiracion (mm)`, na.rm = TRUE),
                   `Lluvia (mm)` = sum(`Lluvia (mm)`, na.rm = TRUE),
                   `Deficit de presion de vapor (DPV)` = mean(`DPVfinal`, na.rm = TRUE),
                   `Grados Calor (18.3 °C)` = sum(`GC`, na.rm = TRUE),
                   `Grados Frio (18.3 °C)` = sum(`GF`, na.rm = TRUE), 
                   `Grados Calor (10 °C)` = sum(`GC10`, na.rm = TRUE),
                   `Grados Frio (10 °C)` = sum(`GF10`, na.rm = TRUE), 
                   `Grados Calor (15 °C)` = sum(`GC15`, na.rm = TRUE),
                   `Grados Frio (15 °C)` = sum(`GF15`, na.rm = TRUE), 
                   `Grados Calor (24 °C)` = sum(`GC24`, na.rm = TRUE),
                   `Grados Frio (24 °C)` = sum(`GF24`, na.rm = TRUE)) %>%
  dplyr::ungroup() %>%
  dplyr::rename(Date = Date2)

clima_dia <- clima_means %>%
  left_join(clima_temp, by = c("Date")) %>%
  left_join(clima_horas, by = c("Date"))

clima <- clima_dia %>%
  mutate(Date = ceiling_date(Date, "week")) %>%
  group_by(Date) %>%
  summarise(`Temp. Maxima (°C) max` = max(`Temp. Maxima (°C)`,na.rm = TRUE),
            `Temp. Maxima (°C) mean` = mean(`Temp. Maxima (°C)`,na.rm = TRUE),
            `Temp. Maxima (°C) sd` = sd(`Temp. Maxima (°C)`,na.rm = TRUE),
            `Temp. Minima (°C) min` = min(`Temp. Minima (°C)`,na.rm = TRUE),
            `Temp. Minima (°C) mean` = mean(`Temp. Minima (°C)`,na.rm = TRUE),
            `Temp. Minima (°C) sd` = sd(`Temp. Minima (°C)`,na.rm = TRUE),
            `Temp. Media (°C) mean` = mean(`Temp. Media (°C)`,na.rm = TRUE),
            `Temp. Media (°C) sd` = sd(`Temp. Media (°C)`,na.rm = TRUE),
            `Temp. Exterior (°C) mean` = mean(`Temp. Exterior (°C)`,na.rm = TRUE),
            `Temp. Exterior (°C) sd` = sd(`Temp. Exterior (°C)`,na.rm = TRUE),
            `Humedad Externa (%) mean` = mean(`Humedad Externa (%)`,na.rm = TRUE),
            `Humedad Externa (%) sd` = sd(`Humedad Externa (%)`,na.rm = TRUE),
            `Horas Calor sum` = sum(`Horas Calor`, na.rm = TRUE),
            `Horas Calor sd` = sd(`Horas Calor`, na.rm = TRUE),
            `Horas Frio sum` = sum(`Horas Frio`, na.rm = TRUE),
            `Horas Frio sd` = sd(`Horas Frio`, na.rm = TRUE),
            `Dias Grado sum` = sum(`Dias Grado`, na.rm = TRUE),
            `Dias Grado sd` = sd(`Dias Grado`, na.rm = TRUE),
            `Horas Rocio sum` = sum(`Horas Rocio`, na.rm = TRUE),
            `Horas Rocio sd` = sd(`Horas Rocio`, na.rm = TRUE),
            `Lluvia (mm) sum` = sum(`Lluvia (mm)`, na.rm = TRUE),
            `Lluvia (mm) mean` = mean(`Lluvia (mm)`, na.rm = TRUE),
            `Lluvia (mm) sd` = sd(`Lluvia (mm)`, na.rm = TRUE),
            `Radiacion Solar (w/m2) mean` = mean(`Radiacion Solar (w/m2)`, na.rm = TRUE),
            `Radiacion Solar (w/m2) sd` = sd(`Radiacion Solar (w/m2)`, na.rm = TRUE),
            `Evapotranspiracion (mm) sum` = sum(`Evapotranspiracion (mm)`, na.rm = TRUE),
            `Evapotranspiracion (mm) mean` = mean(`Evapotranspiracion (mm)`, na.rm = TRUE),
            `Evapotranspiracion (mm) sd` = sd(`Evapotranspiracion (mm)`, na.rm = TRUE),
            `Punto Rocio (°C) mean` = mean(`Punto Rocio (°C)`, na.rm = TRUE),
            `Punto Rocio (°C) sd` = sd(`Punto Rocio (°C)`, na.rm = TRUE),
            `Vel. Min Viento (km/hr) mean` = mean(`Vel. Min Viento (km/hr)`, na.rm = TRUE),
            `Vel. Min Viento (km/hr) sd` = sd(`Vel. Min Viento (km/hr)`, na.rm = TRUE),
            `Viento Durante un Intervalo mean` = mean(`Viento Durante un Intervalo`, na.rm = TRUE),
            `Viento Durante un Intervalo sd` = sd(`Viento Durante un Intervalo`, na.rm = TRUE),
            `Velocida Max (km/hr) mean` = mean(`Velocida Max (km/hr)`, na.rm = TRUE),
            `Velocida Max (km/hr) sd` = sd(`Velocida Max (km/hr)`, na.rm = TRUE),
            `Factor enfria por Viento (°C) mean` = mean(`Factor enfria por Viento (°C)`, na.rm = TRUE),
            `Factor enfria por Viento (°C) sd` = sd(`Factor enfria por Viento (°C)`, na.rm = TRUE),
            `Indice de Calor mean` = mean(`Indice de Calor`, na.rm = TRUE),
            `Indice de Calor sd` = sd(`Indice de Calor`, na.rm = TRUE),
            `Indice de Tem. Hum. Viento mean` = mean(`Indice de Tem. Hum. Viento`, na.rm = TRUE),
            `Indice de Tem. Hum. Viento sd` = sd(`Indice de Tem. Hum. Viento`, na.rm = TRUE),
            `Presion Atmosfera (mm) mean` = mean(`Presion Atmosfera (mm)`, na.rm = TRUE),
            `Presion Atmosfera (mm) sd` = sd(`Presion Atmosfera (mm)`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) mean` = mean(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) sd` = sd(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Energia solar (w/m2) mean` = mean(`Energia solar (w/m2)`, na.rm = TRUE),
            `Energia solar (w/m2) sd` = sd(`Energia solar (w/m2)`, na.rm = TRUE),
            `Alta Radiacion sol. (w/m2) mean` = mean(`Alta Radiacion sol. (w/m2)`, na.rm = TRUE),
            `Alta Radiacion sol. (w/m2) sd` = sd(`Alta Radiacion sol. (w/m2)`, na.rm = TRUE),
            `Indice Rayos UV mean` = mean(`Indice Rayos UV`, na.rm = TRUE),
            `Indice Rayos UV sd` = sd(`Indice Rayos UV`, na.rm = TRUE),
            # # `Dosis UV mean` = mean(`Dosis UV`, na.rm = TRUE),
            # `Dosis UV sd` = sd(`Dosis UV`, na.rm = TRUE),
            `Alta Radiacion UV mean` = mean(`Alta Radiacion UV`, na.rm = TRUE),
            `Alta Radiacion UV sd` = sd(`Alta Radiacion UV`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) mean` = mean(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) sd` = sd(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Grados Calor (18.3 °C) sum` = sum(`Grados Calor (18.3 °C)`, na.rm = TRUE),
            `Grados Calor (18.3 °C) mean` = mean(`Grados Calor (18.3 °C)`, na.rm = TRUE),
            `Grados Calor (18.3 °C) sd` = sd(`Grados Calor (18.3 °C)`, na.rm = TRUE),
            `Grados Frio (18.3 °C) sum` = sum(`Grados Frio (18.3 °C)`, na.rm = TRUE),
            `Grados Frio (18.3 °C) mean` = mean(`Grados Frio (18.3 °C)`, na.rm = TRUE),
            `Grados Frio (18.3 °C) sd` = sd(`Grados Frio (18.3 °C)`, na.rm = TRUE),
            `Grados Calor (10 °C) sum` = sum(`Grados Calor (10 °C)`, na.rm = TRUE),
            `Grados Calor (10 °C) mean` = mean(`Grados Calor (10 °C)`, na.rm = TRUE),
            `Grados Calor (10 °C) sd` = sd(`Grados Calor (10 °C)`, na.rm = TRUE),
            `Grados Frio (10 °C) sum` = sum(`Grados Frio (10 °C)`, na.rm = TRUE),
            `Grados Frio (10 °C) mean` = mean(`Grados Frio (10 °C)`, na.rm = TRUE),
            `Grados Frio (10 °C) sd` = sd(`Grados Frio (10 °C)`, na.rm = TRUE),
            `Grados Calor (15 °C) sum` = sum(`Grados Calor (15 °C)`, na.rm = TRUE),
            `Grados Calor (15 °C) mean` = mean(`Grados Calor (15 °C)`, na.rm = TRUE),
            `Grados Calor (15 °C) sd` = sd(`Grados Calor (15 °C)`, na.rm = TRUE),
            `Grados Frio (15 °C) sum` = sum(`Grados Frio (15 °C)`, na.rm = TRUE),
            `Grados Frio (15 °C) mean` = mean(`Grados Frio (15 °C)`, na.rm = TRUE),
            `Grados Frio (15 °C) sd` = sd(`Grados Frio (15 °C)`, na.rm = TRUE),
            `Grados Calor (24 °C) sum` = sum(`Grados Calor (24 °C)`, na.rm = TRUE),
            `Grados Calor (24 °C) mean` = mean(`Grados Calor (24 °C)`, na.rm = TRUE),
            `Grados Calor (24 °C) sd` = sd(`Grados Calor (24 °C)`, na.rm = TRUE),
            `Grados Frio (24 °C) sum` = sum(`Grados Frio (24 °C)`, na.rm = TRUE),
            `Grados Frio (24 °C) mean` = mean(`Grados Frio (24 °C)`, na.rm = TRUE),
            `Grados Frio (24 °C) sd` = sd(`Grados Frio (24 °C)`, na.rm = TRUE),
            `Temp. Interna (°C) mean` = mean(`Temp. Interna (°C)`, na.rm = TRUE),
            `Temp. Interna (°C) sd` = sd(`Temp. Interna (°C)`, na.rm = TRUE),
            `Hum. Interna (%) mean` = mean(`Hum. Interna (%)`, na.rm = TRUE),
            `Hum. Interna (%) sd` = sd(`Hum. Interna (%)`, na.rm = TRUE),
            # `Rocio mean` = mean(`Rocio`, na.rm = TRUE),
            # `Rocio sd` = sd(`Rocio`, na.rm = TRUE),
            # `Calor mean` = mean(`Calor`, na.rm = TRUE),
            # `Calor sd` = sd(`Calor`, na.rm = TRUE),
            `Deficit de presion de vapor (DPV) sum` = sum(`Deficit de presion de vapor (DPV)`, na.rm = TRUE),
            `Deficit de presion de vapor (DPV) mean` = mean(`Deficit de presion de vapor (DPV)`, na.rm = TRUE),
            `Deficit de presion de vapor (DPV) sd` = sd(`Deficit de presion de vapor (DPV)`, na.rm = TRUE)
  ) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(Año = as.numeric(format(Date, format = "%Y")),
         Semana = as.numeric(format(Date, format = "%W"))) %>%
  dplyr::group_by(Año) %>%
  dplyr::mutate(`Horas Calor cumsum` = cumsum(`Horas Calor sum`),
                `Horas Frio cumsum` = cumsum(`Horas Frio sum`),
                `Horas Rocio cumsum` = cumsum(`Horas Rocio sum`),
                `Radiacion Solar (w/m2) cumsum` = cumsum(`Radiacion Solar (w/m2) mean`),
                `Dias Grado cumsum` = cumsum(`Dias Grado sum`),
                `Evapotranspiracion (mm) cumsum` = cumsum(`Evapotranspiracion (mm) sum`),
                `Lluvia (mm) cumsum` = cumsum(`Lluvia (mm) sum`),
                `Deficit de presion de vapor (DPV) cumsum` = cumsum(`Deficit de presion de vapor (DPV) sum`),
                `Diferencial termico` = `Temp. Maxima (°C) max` - 
                  `Temp. Minima (°C) min`,
                `Diferencial termico cumsum` = cumsum(`Diferencial termico`)) %>%
  dplyr::ungroup() %>%
  dplyr::filter(!Año == 2018)

write.csv(clima, "data_victoria.csv", row.names = F)
```

### Temperatura

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Temp. Maxima (°C) max`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Temperatura (°C) máxima",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(18,34), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Temp. Media (°C) mean`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Temperatura (°C) media",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(15,28), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Temp. Minima (°C) min`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Temperatura (°C) mínima",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(10,24), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

### Diferencial térmico

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Diferencial termico`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Diferencial térmico (°C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,20), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

### Horas calor (>= 24 °C) y Horas frío (<= 15 °C)

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Calor sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Horas calor (>= 24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Frio sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Horas frío (<= 15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	


```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Horas Calor sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Horas Calor cumsum` = cumsum(`Horas Calor sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Calor cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Horas calor (>= 24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1300), breaks=0:100*100,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Frio cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Horas frío (<= 15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,900), breaks=0:100*100,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Horas rocío

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Rocio sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Horas rocío",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,20), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Horas Rocio sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Horas Rocio cumsum` = cumsum(`Horas Rocio sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Rocio cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Horas rocío",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,200), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Radiación solar

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Radiacion Solar (w/m2) mean`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Radiación solar (W/m²)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "W/m²")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(200,1100), breaks=0:100*50,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Radiacion Solar (w/m2) mean`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Radiacion Solar (w/m2) cumsum` = cumsum(`Radiacion Solar (w/m2) mean`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Radiacion Solar (w/m2) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Radiación solar (W/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
   scale_y_continuous(limits = c(0,50000), breaks=0:100*5000,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	


### Grados de calor y frio {.tabset .tabset-fade .tabset-pills}

#### Base 10 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (10 °C)` = `Grados Calor (10 °C) sum`,
         `Grados frío (10 °C)` = `Grados Frio (10 °C) sum`) %>%
  select(Date,`Grados calor (10 °C)`,`Grados frío (10 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (10 °C)",
                                           "frío (10 °C)"),
                                labels = c("Grados calor (10 °C)",
                                           "Grados frío (10 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (10 °C) y Grados frío (10 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (10 °C)` = `Grados Calor (10 °C) sum`,
         `Grados frío (10 °C)` = `Grados Frio (10 °C) sum`) %>%
  select(Date,`Grados calor (10 °C)`,`Grados frío (10 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (10 °C)",
                                           "frío (10 °C)"),
                                labels = c("Grados calor (10 °C)",
                                           "Grados frío (10 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (10 °C)",
                                           "frío (10 °C)"),
                                labels = c("Grados calor (10 °C)",
                                           "Grados frío (10 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (10 °C) y Grados frío (10 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,4000), breaks=0:100*500,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```
#### Base 15 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (15 °C)` = `Grados Calor (15 °C) sum`,
         `Grados frío (15 °C)` = `Grados Frio (15 °C) sum`) %>%
  select(Date,`Grados calor (15 °C)`,`Grados frío (15 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (15 °C)",
                                           "frío (15 °C)"),
                                labels = c("Grados calor (15 °C)",
                                           "Grados frío (15 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (15 °C) y Grados frío (15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,100), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (15 °C)` = `Grados Calor (15 °C) sum`,
         `Grados frío (15 °C)` = `Grados Frio (15 °C) sum`) %>%
  select(Date,`Grados calor (15 °C)`,`Grados frío (15 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (15 °C)",
                                           "frío (15 °C)"),
                                labels = c("Grados calor (15 °C)",
                                           "Grados frío (15 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (15 °C)",
                                           "frío (15 °C)"),
                                labels = c("Grados calor (15 °C)",
                                           "Grados frío (15 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (15 °C) y Grados frío (15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,65), breaks=0:100*500,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```

#### Base 18.3 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (18.3 °C)` = `Grados Calor (18.3 °C) sum`,
         `Grados frío (18.3 °C)` = `Grados Frio (18.3 °C) sum`) %>%
  select(Date,`Grados calor (18.3 °C)`,`Grados frío (18.3 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (18.3 °C)",
                                           "frío (18.3 °C)"),
                                labels = c("Grados calor (18.3 °C)",
                                           "Grados frío (18.3 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (18.3 °C) y Grados frío (18.3 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,80), breaks=0:100*10,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (18.3 °C)` = `Grados Calor (18.3 °C) sum`,
         `Grados frío (18.3 °C)` = `Grados Frio (18.3 °C) sum`) %>%
  select(Date,`Grados calor (18.3 °C)`,`Grados frío (18.3 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (18.3 °C)",
                                           "frío (18.3 °C)"),
                                labels = c("Grados calor (18.3 °C)",
                                           "Grados frío (18.3 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (18.3 °C)",
                                           "frío (18.3 °C)"),
                                labels = c("Grados calor (18.3 °C)",
                                           "Grados frío (18.3 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (18.3 °C) y Grados frío (18.3 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1500), breaks=0:100*250,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```

#### Base 24 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (24 °C)` = `Grados Calor (24 °C) sum`,
         `Grados frío (24 °C)` = `Grados Frio (24 °C) sum`) %>%
  select(Date,`Grados calor (24 °C)`,`Grados frío (24 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (24 °C)",
                                           "frío (24 °C)"),
                                labels = c("Grados calor (24 °C)",
                                           "Grados frío (24 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (24 °C) y Grados frío (24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (24 °C)` = `Grados Calor (24 °C) sum`,
         `Grados frío (24 °C)` = `Grados Frio (24 °C) sum`) %>%
  select(Date,`Grados calor (24 °C)`,`Grados frío (24 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (24 °C)",
                                           "frío (24 °C)"),
                                labels = c("Grados calor (24 °C)",
                                           "Grados frío (24 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (24 °C)",
                                           "frío (24 °C)"),
                                labels = c("Grados calor (24 °C)",
                                           "Grados frío (24 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (24 °C) y Grados frío (24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,2000), breaks=0:100*250,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```

### Días grado {.tabset .tabset-fade .tabset-pills}

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Dias Grado sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Días Grado (°C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(30,130), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Dias Grado sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Dias Grado cumsum` = cumsum(`Dias Grado sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Dias Grado cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Días Grado (°C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,4500), breaks=0:100*500,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Humedad relativa

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Humedad Externa (%) mean`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Humedad relativa (%)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "%")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(75,100), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

### Evapotranspiración

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Evapotranspiracion (mm) sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Evapotranspiración (mm/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m²")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,45), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Evapotranspiracion (mm) sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Evapotranspiracion (mm) cumsum` = cumsum(`Evapotranspiracion (mm) sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Evapotranspiracion (mm) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Evapotranspiración (mm/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m² acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1100), breaks=0:100*50,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Precipitación pluvial

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Lluvia (mm) sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Precipitación pluvial (mm/m²)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m²")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,5), breaks=0:100*1,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Lluvia (mm) sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Lluvia (mm) cumsum` = cumsum(`Lluvia (mm) sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Lluvia (mm) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Precipitación pluvial (mm/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m² acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,25), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Déficit de presión de vapor

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Deficit de presion de vapor (DPV) sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Déficit de presión de vapor (DPV)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "KPa")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,30), breaks=0:100*10,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Deficit de presion de vapor (DPV) sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Deficit de presion de vapor (DPV) cumsum` = cumsum(`Deficit de presion de vapor (DPV) sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Deficit de presion de vapor (DPV) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Déficit de presión de vapor (DPV)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "KPa acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1000), breaks=0:100*50,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

## Fundo Compositan {.tabset .tabset-fade .tabset-pills}

```{r,echo=FALSE,comment=NA, warning=FALSE,message=FALSE}
all_na <- function(x) any(!is.na(x))
spaceless <- function(x) {colnames(x) <- gsub(c("\\s\\s"), " ", colnames(x));x}

datos_clima <- readxl::read_excel("Datos clima 2.xlsx",sheet = "Compositan")
clima_pre <- datos_clima %>%
  mutate(#Semana = isoweek(Date),
    Fecha = ceiling_date(Date, "week"),
    Semana = isoweek(Fecha),
    Date = as.Date(Date, format = "%Y%m%d"),
    `Temp. Media (°C)` = (`Temp. Maxima (°C)`+`Temp. Minima (°C)`)/2#,
    #Año_corregido = year(ceiling_date(Date, "week")),
    #DiadelAño = as.numeric(format(Date, format = "%j")),
    #DiadelMes = as.numeric(format(Date, format = "%d")),
    #DiadelaSemana = as.numeric(format(Date, format = "%u")),
    #MesdelAño = as.numeric(format(Date, format = "%m"))
  ) %>%
  dplyr::select_if(all_na)%>%
  # janitor::clean_names()
  spaceless() %>%
  dplyr::mutate(Time = round(Time*24,0),
                Date2 = if_else(Time != 0, Date, Date-1),
                DiadelAño = as.numeric(format(Date2, format = "%j")),
                DiadelMes = as.numeric(format(Date2, format = "%d")),
                DiadelaSemana = as.numeric(format(Date2, format = "%u")),
                Año = lubridate::year(Date))

# clima_means <- clima_pre %>%
#   dplyr::filter(is.na(Time)) %>%
#   dplyr::select(Date,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
#                 `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
#                 `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
#                 `Factor enfria por Viento (°C)`,`Indice de Calor`,
#                 `Indice de Tem. Hum. Viento`,
#                 `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
#                 `Grados Caloricos dia (°C)`,
#                 `Grados Frio (°C)`, `Temp. Interna (°C)`,
#                 `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
#                 `Evapotranspiracion (mm)`,`Lluvia (mm)`,`Temp. Maxima (°C)`,
#                 `Temp. Minima (°C)`,`Temp. Media (°C) mean (°C)`,`Radiacion Solar (w/m2)`,
#                 `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
#                 `Indice Rayos UV`, `Dosis UV`, `Alta Radiacion UV`)

clima_means <- clima_pre %>%
  dplyr::group_by(Date2) %>%
  dplyr::summarise_if(is.numeric, mean, na.rm = TRUE) %>%
  dplyr::ungroup() %>%
  dplyr::select(Date2,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
                `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
                `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
                `Factor enfria por Viento (°C)`,`Indice de Calor`,
                `Indice de Tem. Hum. Viento`,
                `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
                `Temp. Interna (°C)`,
                `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
                #`Evapotranspiracion (mm)`,`Lluvia (mm)`,
                # `Temp. Maxima (°C)`,
                # `Temp. Minima (°C)`,`Temp. Media (°C)`,`Radiacion Solar (w/m2)`,
                `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
                `Indice Rayos UV`, # `Dosis UV`,
                `Alta Radiacion UV`) %>%
  dplyr::rename(Date = Date2)

# colnames(clima_means)[-1] <- paste(colnames(clima_means)[-1], "mean", sep = " ")

# clima_max <- clima_pre %>%
#   dplyr::group_by(Date2) %>%
#   dplyr::summarise_if(is.numeric, max, na.rm = TRUE) %>%
#   dplyr::ungroup() %>%
#   dplyr::select(Date2,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
#                 `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
#                 `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
#                 `Factor enfria por Viento (°C)`,`Indice de Calor`,
#                 `Indice de Tem. Hum. Viento`,
#                 `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
#                 `Grados Caloricos dia (°C)`,
#                 `Grados Frio (°C)`, `Temp. Interna (°C)`,
#                 `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
#                 `Evapotranspiracion (mm)`,`Lluvia (mm)`,`Temp. Maxima (°C)`,
#                 `Temp. Minima (°C)`,`Temp. Media (°C)`,`Radiacion Solar (w/m2)`,
#                 `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
#                 `Indice Rayos UV`, `Dosis UV`, `Alta Radiacion UV`) %>%
#   dplyr::rename(Date = Date2)
# colnames(clima_max)[-1] <- paste(colnames(clima_max)[-1], "max", sep = " ")
# 
# clima_min <- clima_pre %>%
#   dplyr::group_by(Date2) %>%
#   dplyr::summarise_if(is.numeric, min, na.rm = TRUE) %>%
#   dplyr::ungroup() %>%
#   dplyr::select(Date2,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
#                 `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
#                 `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
#                 `Factor enfria por Viento (°C)`,`Indice de Calor`,
#                 `Indice de Tem. Hum. Viento`,
#                 `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
#                 `Grados Caloricos dia (°C)`,
#                 `Grados Frio (°C)`, `Temp. Interna (°C)`,
#                 `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
#                 `Evapotranspiracion (mm)`,`Lluvia (mm)`,`Temp. Maxima (°C)`,
#                 `Temp. Minima (°C)`,`Temp. Media (°C)`,`Radiacion Solar (w/m2)`,
#                 `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
#                 `Indice Rayos UV`, `Dosis UV`, `Alta Radiacion UV`) %>%
#   dplyr::rename(Date = Date2)
# colnames(clima_min)[-1] <- paste(colnames(clima_min)[-1], "min", sep = " ")

clima_horas <- clima_pre %>%
  dplyr::filter(!is.na(Time)) %>%
  #recipes::step_nzv(all_predictors()) %>%
  dplyr::group_by(Date2,Time) %>%
  dplyr::summarise(`Temp. Maxima (°C)` = max(`Temp. Maxima (°C)`,na.rm = TRUE),
                   `Temp. Minima (°C)` = min(`Temp. Minima (°C)`,na.rm = TRUE),
                   #`Temp. Media (°C)` = (`Temp. Maxima (°C)`+`Temp. Minima (°C)`)/2,
                   `Dias Grado` = (`Temp. Exterior (°C)` - 10)/24,
                   `Dias Grado` = ifelse(`Dias Grado` < 0, 0, `Dias Grado`),
                   `Horas Rocio` = sum(`Horas Rocio`, na.rm = TRUE)) %>%
  dplyr::ungroup() %>%
  dplyr::group_by(Date2) %>%
  dplyr::summarise(`Horas Calor` = sum(`Temp. Minima (°C)`>=24, na.rm = TRUE)/n()*24,
                   `Horas Frio` = sum(`Temp. Maxima (°C)`<=15, na.rm = TRUE)/n()*24,
                   `Dias Grado` = sum(`Dias Grado`)/n()*24,
                   `Dias Grado` = ifelse(`Dias Grado` < 0, 0, `Dias Grado`),
                   `Horas Rocio` = sum(`Horas Rocio`)/n()*24,
                   `Horas Rocio` = ifelse(`Horas Rocio` < 0, 0, `Horas Rocio`)) %>%
  dplyr::ungroup() %>%
  dplyr::rename(Date = Date2) %>%
  tidyr::replace_na(list(`Dias Grado` = 0,
                         `Horas Rocio` = 0))

clima_temp <- clima_pre %>%
  dplyr::filter(!is.na(Time)) %>%
  #recipes::step_nzv(all_predictors()) %>%
  dplyr::group_by(Date2) %>%
  dplyr::summarise(`Temp. Maxima (°C)` = max(`Temp. Maxima (°C)`,na.rm = TRUE),
                   `Temp. Minima (°C)` = min(`Temp. Minima (°C)`,na.rm = TRUE),
                   `Temp. Media (°C)` = (`Temp. Maxima (°C)`+`Temp. Minima (°C)`)/2,
                   `Radiacion Solar (w/m2)` = max(`Radiacion Solar (w/m2)`, na.rm = TRUE),
                   `Evapotranspiracion (mm)` = sum(`Evapotranspiracion (mm)`, na.rm = TRUE),
                   `Lluvia (mm)` = sum(`Lluvia (mm)`, na.rm = TRUE),
                   `Deficit de presion de vapor (DPV)` = mean(`DPVfinal`, na.rm = TRUE),
                   `Grados Calor (18.3 °C)` = sum(`GC`, na.rm = TRUE),
                   `Grados Frio (18.3 °C)` = sum(`GF`, na.rm = TRUE), 
                   `Grados Calor (10 °C)` = sum(`GC10`, na.rm = TRUE),
                   `Grados Frio (10 °C)` = sum(`GF10`, na.rm = TRUE), 
                   `Grados Calor (15 °C)` = sum(`GC15`, na.rm = TRUE),
                   `Grados Frio (15 °C)` = sum(`GF15`, na.rm = TRUE), 
                   `Grados Calor (24 °C)` = sum(`GC24`, na.rm = TRUE),
                   `Grados Frio (24 °C)` = sum(`GF24`, na.rm = TRUE)) %>%
  dplyr::ungroup() %>%
  dplyr::rename(Date = Date2)

clima_dia <- clima_means %>%
  left_join(clima_temp, by = c("Date")) %>%
  left_join(clima_horas, by = c("Date"))

clima <- clima_dia %>%
  mutate(Date = ceiling_date(Date, "week")) %>%
  group_by(Date) %>%
  summarise(`Temp. Maxima (°C) max` = max(`Temp. Maxima (°C)`,na.rm = TRUE),
            `Temp. Maxima (°C) mean` = mean(`Temp. Maxima (°C)`,na.rm = TRUE),
            `Temp. Maxima (°C) sd` = sd(`Temp. Maxima (°C)`,na.rm = TRUE),
            `Temp. Minima (°C) min` = min(`Temp. Minima (°C)`,na.rm = TRUE),
            `Temp. Minima (°C) mean` = mean(`Temp. Minima (°C)`,na.rm = TRUE),
            `Temp. Minima (°C) sd` = sd(`Temp. Minima (°C)`,na.rm = TRUE),
            `Temp. Media (°C) mean` = mean(`Temp. Media (°C)`,na.rm = TRUE),
            `Temp. Media (°C) sd` = sd(`Temp. Media (°C)`,na.rm = TRUE),
            `Temp. Exterior (°C) mean` = mean(`Temp. Exterior (°C)`,na.rm = TRUE),
            `Temp. Exterior (°C) sd` = sd(`Temp. Exterior (°C)`,na.rm = TRUE),
            `Humedad Externa (%) mean` = mean(`Humedad Externa (%)`,na.rm = TRUE),
            `Humedad Externa (%) sd` = sd(`Humedad Externa (%)`,na.rm = TRUE),
            `Horas Calor sum` = sum(`Horas Calor`, na.rm = TRUE),
            `Horas Calor sd` = sd(`Horas Calor`, na.rm = TRUE),
            `Horas Frio sum` = sum(`Horas Frio`, na.rm = TRUE),
            `Horas Frio sd` = sd(`Horas Frio`, na.rm = TRUE),
            `Dias Grado sum` = sum(`Dias Grado`, na.rm = TRUE),
            `Dias Grado sd` = sd(`Dias Grado`, na.rm = TRUE),
            `Horas Rocio sum` = sum(`Horas Rocio`, na.rm = TRUE),
            `Horas Rocio sd` = sd(`Horas Rocio`, na.rm = TRUE),
            `Lluvia (mm) sum` = sum(`Lluvia (mm)`, na.rm = TRUE),
            `Lluvia (mm) mean` = mean(`Lluvia (mm)`, na.rm = TRUE),
            `Lluvia (mm) sd` = sd(`Lluvia (mm)`, na.rm = TRUE),
            `Radiacion Solar (w/m2) mean` = mean(`Radiacion Solar (w/m2)`, na.rm = TRUE),
            `Radiacion Solar (w/m2) sd` = sd(`Radiacion Solar (w/m2)`, na.rm = TRUE),
            `Evapotranspiracion (mm) sum` = sum(`Evapotranspiracion (mm)`, na.rm = TRUE),
            `Evapotranspiracion (mm) mean` = mean(`Evapotranspiracion (mm)`, na.rm = TRUE),
            `Evapotranspiracion (mm) sd` = sd(`Evapotranspiracion (mm)`, na.rm = TRUE),
            `Punto Rocio (°C) mean` = mean(`Punto Rocio (°C)`, na.rm = TRUE),
            `Punto Rocio (°C) sd` = sd(`Punto Rocio (°C)`, na.rm = TRUE),
            `Vel. Min Viento (km/hr) mean` = mean(`Vel. Min Viento (km/hr)`, na.rm = TRUE),
            `Vel. Min Viento (km/hr) sd` = sd(`Vel. Min Viento (km/hr)`, na.rm = TRUE),
            `Viento Durante un Intervalo mean` = mean(`Viento Durante un Intervalo`, na.rm = TRUE),
            `Viento Durante un Intervalo sd` = sd(`Viento Durante un Intervalo`, na.rm = TRUE),
            `Velocida Max (km/hr) mean` = mean(`Velocida Max (km/hr)`, na.rm = TRUE),
            `Velocida Max (km/hr) sd` = sd(`Velocida Max (km/hr)`, na.rm = TRUE),
            `Factor enfria por Viento (°C) mean` = mean(`Factor enfria por Viento (°C)`, na.rm = TRUE),
            `Factor enfria por Viento (°C) sd` = sd(`Factor enfria por Viento (°C)`, na.rm = TRUE),
            `Indice de Calor mean` = mean(`Indice de Calor`, na.rm = TRUE),
            `Indice de Calor sd` = sd(`Indice de Calor`, na.rm = TRUE),
            `Indice de Tem. Hum. Viento mean` = mean(`Indice de Tem. Hum. Viento`, na.rm = TRUE),
            `Indice de Tem. Hum. Viento sd` = sd(`Indice de Tem. Hum. Viento`, na.rm = TRUE),
            `Presion Atmosfera (mm) mean` = mean(`Presion Atmosfera (mm)`, na.rm = TRUE),
            `Presion Atmosfera (mm) sd` = sd(`Presion Atmosfera (mm)`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) mean` = mean(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) sd` = sd(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Energia solar (w/m2) mean` = mean(`Energia solar (w/m2)`, na.rm = TRUE),
            `Energia solar (w/m2) sd` = sd(`Energia solar (w/m2)`, na.rm = TRUE),
            `Alta Radiacion sol. (w/m2) mean` = mean(`Alta Radiacion sol. (w/m2)`, na.rm = TRUE),
            `Alta Radiacion sol. (w/m2) sd` = sd(`Alta Radiacion sol. (w/m2)`, na.rm = TRUE),
            `Indice Rayos UV mean` = mean(`Indice Rayos UV`, na.rm = TRUE),
            `Indice Rayos UV sd` = sd(`Indice Rayos UV`, na.rm = TRUE),
            # # `Dosis UV mean` = mean(`Dosis UV`, na.rm = TRUE),
            # `Dosis UV sd` = sd(`Dosis UV`, na.rm = TRUE),
            `Alta Radiacion UV mean` = mean(`Alta Radiacion UV`, na.rm = TRUE),
            `Alta Radiacion UV sd` = sd(`Alta Radiacion UV`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) mean` = mean(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) sd` = sd(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Grados Calor (18.3 °C) sum` = sum(`Grados Calor (18.3 °C)`, na.rm = TRUE),
            `Grados Calor (18.3 °C) mean` = mean(`Grados Calor (18.3 °C)`, na.rm = TRUE),
            `Grados Calor (18.3 °C) sd` = sd(`Grados Calor (18.3 °C)`, na.rm = TRUE),
            `Grados Frio (18.3 °C) sum` = sum(`Grados Frio (18.3 °C)`, na.rm = TRUE),
            `Grados Frio (18.3 °C) mean` = mean(`Grados Frio (18.3 °C)`, na.rm = TRUE),
            `Grados Frio (18.3 °C) sd` = sd(`Grados Frio (18.3 °C)`, na.rm = TRUE),
            `Grados Calor (10 °C) sum` = sum(`Grados Calor (10 °C)`, na.rm = TRUE),
            `Grados Calor (10 °C) mean` = mean(`Grados Calor (10 °C)`, na.rm = TRUE),
            `Grados Calor (10 °C) sd` = sd(`Grados Calor (10 °C)`, na.rm = TRUE),
            `Grados Frio (10 °C) sum` = sum(`Grados Frio (10 °C)`, na.rm = TRUE),
            `Grados Frio (10 °C) mean` = mean(`Grados Frio (10 °C)`, na.rm = TRUE),
            `Grados Frio (10 °C) sd` = sd(`Grados Frio (10 °C)`, na.rm = TRUE),
            `Grados Calor (15 °C) sum` = sum(`Grados Calor (15 °C)`, na.rm = TRUE),
            `Grados Calor (15 °C) mean` = mean(`Grados Calor (15 °C)`, na.rm = TRUE),
            `Grados Calor (15 °C) sd` = sd(`Grados Calor (15 °C)`, na.rm = TRUE),
            `Grados Frio (15 °C) sum` = sum(`Grados Frio (15 °C)`, na.rm = TRUE),
            `Grados Frio (15 °C) mean` = mean(`Grados Frio (15 °C)`, na.rm = TRUE),
            `Grados Frio (15 °C) sd` = sd(`Grados Frio (15 °C)`, na.rm = TRUE),
            `Grados Calor (24 °C) sum` = sum(`Grados Calor (24 °C)`, na.rm = TRUE),
            `Grados Calor (24 °C) mean` = mean(`Grados Calor (24 °C)`, na.rm = TRUE),
            `Grados Calor (24 °C) sd` = sd(`Grados Calor (24 °C)`, na.rm = TRUE),
            `Grados Frio (24 °C) sum` = sum(`Grados Frio (24 °C)`, na.rm = TRUE),
            `Grados Frio (24 °C) mean` = mean(`Grados Frio (24 °C)`, na.rm = TRUE),
            `Grados Frio (24 °C) sd` = sd(`Grados Frio (24 °C)`, na.rm = TRUE),
            `Temp. Interna (°C) mean` = mean(`Temp. Interna (°C)`, na.rm = TRUE),
            `Temp. Interna (°C) sd` = sd(`Temp. Interna (°C)`, na.rm = TRUE),
            `Hum. Interna (%) mean` = mean(`Hum. Interna (%)`, na.rm = TRUE),
            `Hum. Interna (%) sd` = sd(`Hum. Interna (%)`, na.rm = TRUE),
            # `Rocio mean` = mean(`Rocio`, na.rm = TRUE),
            # `Rocio sd` = sd(`Rocio`, na.rm = TRUE),
            # `Calor mean` = mean(`Calor`, na.rm = TRUE),
            # `Calor sd` = sd(`Calor`, na.rm = TRUE),
            `Deficit de presion de vapor (DPV) sum` = sum(`Deficit de presion de vapor (DPV)`, na.rm = TRUE),
            `Deficit de presion de vapor (DPV) mean` = mean(`Deficit de presion de vapor (DPV)`, na.rm = TRUE),
            `Deficit de presion de vapor (DPV) sd` = sd(`Deficit de presion de vapor (DPV)`, na.rm = TRUE)
  ) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(Año = as.numeric(format(Date, format = "%Y")),
         Semana = as.numeric(format(Date, format = "%W"))) %>%
  dplyr::group_by(Año) %>%
  dplyr::mutate(`Horas Calor cumsum` = cumsum(`Horas Calor sum`),
                `Horas Frio cumsum` = cumsum(`Horas Frio sum`),
                `Horas Rocio cumsum` = cumsum(`Horas Rocio sum`),
                `Radiacion Solar (w/m2) cumsum` = cumsum(`Radiacion Solar (w/m2) mean`),
                `Dias Grado cumsum` = cumsum(`Dias Grado sum`),
                `Evapotranspiracion (mm) cumsum` = cumsum(`Evapotranspiracion (mm) sum`),
                `Lluvia (mm) cumsum` = cumsum(`Lluvia (mm) sum`),
                `Deficit de presion de vapor (DPV) cumsum` = cumsum(`Deficit de presion de vapor (DPV) sum`),
                `Diferencial termico` = `Temp. Maxima (°C) max` - 
                  `Temp. Minima (°C) min`,
                `Diferencial termico cumsum` = cumsum(`Diferencial termico`)) %>%
  dplyr::ungroup() %>%
  dplyr::filter(!Año == 2018)

write.csv(clima, "data_compositan.csv", row.names = F)
```

### Temperatura

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Temp. Maxima (°C) max`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Temperatura (°C) máxima",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(18,34), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Temp. Media (°C) mean`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Temperatura (°C) media",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(15,28), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Temp. Minima (°C) min`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Temperatura (°C) mínima",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(10,24), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

### Diferencial térmico

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Diferencial termico`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Diferencial térmico (°C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,20), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

### Horas calor (>= 24 °C) y Horas frío (<= 15 °C)

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Calor sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Horas calor (>= 24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Frio sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Horas frío (<= 15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	


```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Horas Calor sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Horas Calor cumsum` = cumsum(`Horas Calor sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Calor cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Horas calor (>= 24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1300), breaks=0:100*100,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Frio cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Horas frío (<= 15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,900), breaks=0:100*100,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Horas rocío

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Rocio sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Horas rocío",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,10), breaks=0:100*1,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Horas Rocio sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Horas Rocio cumsum` = cumsum(`Horas Rocio sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Rocio cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Horas rocío",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,20), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Radiación solar

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Radiacion Solar (w/m2) mean`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Radiación solar (W/m²)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "W/m²")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(200,1100), breaks=0:100*50,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Radiacion Solar (w/m2) mean`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Radiacion Solar (w/m2) cumsum` = cumsum(`Radiacion Solar (w/m2) mean`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Radiacion Solar (w/m2) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Radiación solar (W/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
   scale_y_continuous(limits = c(0,50000), breaks=0:100*5000,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	


### Grados de calor y frio {.tabset .tabset-fade .tabset-pills}

#### Base 10 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (10 °C)` = `Grados Calor (10 °C) sum`,
         `Grados frío (10 °C)` = `Grados Frio (10 °C) sum`) %>%
  select(Date,`Grados calor (10 °C)`,`Grados frío (10 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (10 °C)",
                                           "frío (10 °C)"),
                                labels = c("Grados calor (10 °C)",
                                           "Grados frío (10 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (10 °C) y Grados frío (10 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,250), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (10 °C)` = `Grados Calor (10 °C) sum`,
         `Grados frío (10 °C)` = `Grados Frio (10 °C) sum`) %>%
  select(Date,`Grados calor (10 °C)`,`Grados frío (10 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (10 °C)",
                                           "frío (10 °C)"),
                                labels = c("Grados calor (10 °C)",
                                           "Grados frío (10 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (10 °C)",
                                           "frío (10 °C)"),
                                labels = c("Grados calor (10 °C)",
                                           "Grados frío (10 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (10 °C) y Grados frío (10 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,4000), breaks=0:100*500,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```
#### Base 15 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (15 °C)` = `Grados Calor (15 °C) sum`,
         `Grados frío (15 °C)` = `Grados Frio (15 °C) sum`) %>%
  select(Date,`Grados calor (15 °C)`,`Grados frío (15 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (15 °C)",
                                           "frío (15 °C)"),
                                labels = c("Grados calor (15 °C)",
                                           "Grados frío (15 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (15 °C) y Grados frío (15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,130), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (15 °C)` = `Grados Calor (15 °C) sum`,
         `Grados frío (15 °C)` = `Grados Frio (15 °C) sum`) %>%
  select(Date,`Grados calor (15 °C)`,`Grados frío (15 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (15 °C)",
                                           "frío (15 °C)"),
                                labels = c("Grados calor (15 °C)",
                                           "Grados frío (15 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (15 °C)",
                                           "frío (15 °C)"),
                                labels = c("Grados calor (15 °C)",
                                           "Grados frío (15 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (15 °C) y Grados frío (15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,65), breaks=0:100*500,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```

#### Base 18.3 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (18.3 °C)` = `Grados Calor (18.3 °C) sum`,
         `Grados frío (18.3 °C)` = `Grados Frio (18.3 °C) sum`) %>%
  select(Date,`Grados calor (18.3 °C)`,`Grados frío (18.3 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (18.3 °C)",
                                           "frío (18.3 °C)"),
                                labels = c("Grados calor (18.3 °C)",
                                           "Grados frío (18.3 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (18.3 °C) y Grados frío (18.3 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,80), breaks=0:100*10,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (18.3 °C)` = `Grados Calor (18.3 °C) sum`,
         `Grados frío (18.3 °C)` = `Grados Frio (18.3 °C) sum`) %>%
  select(Date,`Grados calor (18.3 °C)`,`Grados frío (18.3 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (18.3 °C)",
                                           "frío (18.3 °C)"),
                                labels = c("Grados calor (18.3 °C)",
                                           "Grados frío (18.3 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (18.3 °C)",
                                           "frío (18.3 °C)"),
                                labels = c("Grados calor (18.3 °C)",
                                           "Grados frío (18.3 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (18.3 °C) y Grados frío (18.3 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1500), breaks=0:100*250,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```

#### Base 24 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (24 °C)` = `Grados Calor (24 °C) sum`,
         `Grados frío (24 °C)` = `Grados Frio (24 °C) sum`) %>%
  select(Date,`Grados calor (24 °C)`,`Grados frío (24 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (24 °C)",
                                           "frío (24 °C)"),
                                labels = c("Grados calor (24 °C)",
                                           "Grados frío (24 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (24 °C) y Grados frío (24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (24 °C)` = `Grados Calor (24 °C) sum`,
         `Grados frío (24 °C)` = `Grados Frio (24 °C) sum`) %>%
  select(Date,`Grados calor (24 °C)`,`Grados frío (24 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (24 °C)",
                                           "frío (24 °C)"),
                                labels = c("Grados calor (24 °C)",
                                           "Grados frío (24 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (24 °C)",
                                           "frío (24 °C)"),
                                labels = c("Grados calor (24 °C)",
                                           "Grados frío (24 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (24 °C) y Grados frío (24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,2000), breaks=0:100*250,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```

### Días grado {.tabset .tabset-fade .tabset-pills}

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Dias Grado sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Días Grado (°C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(30,130), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Dias Grado sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Dias Grado cumsum` = cumsum(`Dias Grado sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Dias Grado cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Días Grado (°C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,4500), breaks=0:100*500,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Humedad relativa

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Humedad Externa (%) mean`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Humedad relativa (%)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "%")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(75,100), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

### Evapotranspiración

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Evapotranspiracion (mm) sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Evapotranspiración (mm/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m²")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,45), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Evapotranspiracion (mm) sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Evapotranspiracion (mm) cumsum` = cumsum(`Evapotranspiracion (mm) sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Evapotranspiracion (mm) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Evapotranspiración (mm/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m² acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1100), breaks=0:100*50,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Precipitación pluvial

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Lluvia (mm) sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Precipitación pluvial (mm/m²)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m²")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,5), breaks=0:100*1,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Lluvia (mm) sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Lluvia (mm) cumsum` = cumsum(`Lluvia (mm) sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Lluvia (mm) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Precipitación pluvial (mm/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m² acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,25), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Déficit de presión de vapor

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Deficit de presion de vapor (DPV) sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Déficit de presión de vapor (DPV)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "KPa")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,30), breaks=0:100*10,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Deficit de presion de vapor (DPV) sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Deficit de presion de vapor (DPV) cumsum` = cumsum(`Deficit de presion de vapor (DPV) sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Deficit de presion de vapor (DPV) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Déficit de presión de vapor (DPV)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "KPa acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1000), breaks=0:100*50,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

## Macrotuneles (Agromorín) {.tabset .tabset-fade .tabset-pills}

```{r,echo=FALSE,comment=NA, warning=FALSE,message=FALSE}
all_na <- function(x) any(!is.na(x))
spaceless <- function(x) {colnames(x) <- gsub(c("\\s\\s"), " ", colnames(x));x}

datos_clima <- readxl::read_excel("Datos clima 2.xlsx",sheet = "Macrotunel")
clima_pre <- datos_clima %>%
  mutate(#Semana = isoweek(Date),
    Fecha = ceiling_date(Date, "week"),
    Semana = isoweek(Fecha),
    Date = as.Date(Date, format = "%Y%m%d"),
    `Temp. Media (°C)` = (`Temp. Maxima (°C)`+`Temp. Minima (°C)`)/2#,
    #Año_corregido = year(ceiling_date(Date, "week")),
    #DiadelAño = as.numeric(format(Date, format = "%j")),
    #DiadelMes = as.numeric(format(Date, format = "%d")),
    #DiadelaSemana = as.numeric(format(Date, format = "%u")),
    #MesdelAño = as.numeric(format(Date, format = "%m"))
  ) %>%
  dplyr::select_if(all_na)%>%
  # janitor::clean_names()
  spaceless() %>%
  dplyr::mutate(Time = round(Time*24,0),
                Date2 = if_else(Time != 0, Date, Date-1),
                DiadelAño = as.numeric(format(Date2, format = "%j")),
                DiadelMes = as.numeric(format(Date2, format = "%d")),
                DiadelaSemana = as.numeric(format(Date2, format = "%u")),
                Año = lubridate::year(Date))

# clima_means <- clima_pre %>%
#   dplyr::filter(is.na(Time)) %>%
#   dplyr::select(Date,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
#                 `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
#                 `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
#                 `Factor enfria por Viento (°C)`,`Indice de Calor`,
#                 `Indice de Tem. Hum. Viento`,
#                 `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
#                 `Grados Caloricos dia (°C)`,
#                 `Grados Frio (°C)`, `Temp. Interna (°C)`,
#                 `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
#                 `Evapotranspiracion (mm)`,`Lluvia (mm)`,`Temp. Maxima (°C)`,
#                 `Temp. Minima (°C)`,`Temp. Media (°C) mean (°C)`,`Radiacion Solar (w/m2)`,
#                 `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
#                 `Indice Rayos UV`, `Dosis UV`, `Alta Radiacion UV`)

clima_means <- clima_pre %>%
  dplyr::group_by(Date2) %>%
  dplyr::summarise_if(is.numeric, mean, na.rm = TRUE) %>%
  dplyr::ungroup() %>%
  dplyr::select(Date2,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
                `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
                `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
                `Factor enfria por Viento (°C)`,`Indice de Calor`,
                `Indice de Tem. Hum. Viento`,
                `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
                `Temp. Interna (°C)`,
                `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
                #`Evapotranspiracion (mm)`,`Lluvia (mm)`,
                # `Temp. Maxima (°C)`,
                # `Temp. Minima (°C)`,`Temp. Media (°C)`,`Radiacion Solar (w/m2)`,
                `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
                `Indice Rayos UV`, # `Dosis UV`,
                `Alta Radiacion UV`) %>%
  dplyr::rename(Date = Date2)

# colnames(clima_means)[-1] <- paste(colnames(clima_means)[-1], "mean", sep = " ")

# clima_max <- clima_pre %>%
#   dplyr::group_by(Date2) %>%
#   dplyr::summarise_if(is.numeric, max, na.rm = TRUE) %>%
#   dplyr::ungroup() %>%
#   dplyr::select(Date2,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
#                 `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
#                 `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
#                 `Factor enfria por Viento (°C)`,`Indice de Calor`,
#                 `Indice de Tem. Hum. Viento`,
#                 `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
#                 `Grados Caloricos dia (°C)`,
#                 `Grados Frio (°C)`, `Temp. Interna (°C)`,
#                 `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
#                 `Evapotranspiracion (mm)`,`Lluvia (mm)`,`Temp. Maxima (°C)`,
#                 `Temp. Minima (°C)`,`Temp. Media (°C)`,`Radiacion Solar (w/m2)`,
#                 `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
#                 `Indice Rayos UV`, `Dosis UV`, `Alta Radiacion UV`) %>%
#   dplyr::rename(Date = Date2)
# colnames(clima_max)[-1] <- paste(colnames(clima_max)[-1], "max", sep = " ")
# 
# clima_min <- clima_pre %>%
#   dplyr::group_by(Date2) %>%
#   dplyr::summarise_if(is.numeric, min, na.rm = TRUE) %>%
#   dplyr::ungroup() %>%
#   dplyr::select(Date2,`Temp. Exterior (°C)`, `Humedad Externa (%)`,
#                 `Punto Rocio (°C)`, `Vel. Min Viento (km/hr)`,
#                 `Viento Durante un Intervalo`, `Velocida Max (km/hr)`,
#                 `Factor enfria por Viento (°C)`,`Indice de Calor`,
#                 `Indice de Tem. Hum. Viento`,
#                 `Presion Atmosfera (mm)`, `Intensidad LLuvia (mm/hr)`,
#                 `Grados Caloricos dia (°C)`,
#                 `Grados Frio (°C)`, `Temp. Interna (°C)`,
#                 `Hum. Interna (%)`, # `Rocio`, `Calor`, `Emc`, `Densidad Aire`,
#                 `Evapotranspiracion (mm)`,`Lluvia (mm)`,`Temp. Maxima (°C)`,
#                 `Temp. Minima (°C)`,`Temp. Media (°C)`,`Radiacion Solar (w/m2)`,
#                 `Energia solar (w/m2)`, `Alta Radiacion sol. (w/m2)`,
#                 `Indice Rayos UV`, `Dosis UV`, `Alta Radiacion UV`) %>%
#   dplyr::rename(Date = Date2)
# colnames(clima_min)[-1] <- paste(colnames(clima_min)[-1], "min", sep = " ")

clima_horas <- clima_pre %>%
  dplyr::filter(!is.na(Time)) %>%
  #recipes::step_nzv(all_predictors()) %>%
  dplyr::group_by(Date2,Time) %>%
  dplyr::summarise(`Temp. Maxima (°C)` = max(`Temp. Maxima (°C)`,na.rm = TRUE),
                   `Temp. Minima (°C)` = min(`Temp. Minima (°C)`,na.rm = TRUE),
                   #`Temp. Media (°C)` = (`Temp. Maxima (°C)`+`Temp. Minima (°C)`)/2,
                   `Dias Grado` = (`Temp. Exterior (°C)` - 10)/24,
                   `Dias Grado` = ifelse(`Dias Grado` < 0, 0, `Dias Grado`),
                   `Horas Rocio` = sum(`Horas Rocio`, na.rm = TRUE)) %>%
  dplyr::ungroup() %>%
  dplyr::group_by(Date2) %>%
  dplyr::summarise(`Horas Calor` = sum(`Temp. Minima (°C)`>=24, na.rm = TRUE)/n()*24,
                   `Horas Frio` = sum(`Temp. Maxima (°C)`<=15, na.rm = TRUE)/n()*24,
                   `Dias Grado` = sum(`Dias Grado`)/n()*24,
                   `Dias Grado` = ifelse(`Dias Grado` < 0, 0, `Dias Grado`),
                   `Horas Rocio` = sum(`Horas Rocio`)/n()*24,
                   `Horas Rocio` = ifelse(`Horas Rocio` < 0, 0, `Horas Rocio`)) %>%
  dplyr::ungroup() %>%
  dplyr::rename(Date = Date2) %>%
  tidyr::replace_na(list(`Dias Grado` = 0,
                         `Horas Rocio` = 0))

clima_temp <- clima_pre %>%
  dplyr::filter(!is.na(Time)) %>%
  #recipes::step_nzv(all_predictors()) %>%
  dplyr::group_by(Date2) %>%
  dplyr::summarise(`Temp. Maxima (°C)` = max(`Temp. Maxima (°C)`,na.rm = TRUE),
                   `Temp. Minima (°C)` = min(`Temp. Minima (°C)`,na.rm = TRUE),
                   `Temp. Media (°C)` = (`Temp. Maxima (°C)`+`Temp. Minima (°C)`)/2,
                   `Radiacion Solar (w/m2)` = max(`Radiacion Solar (w/m2)`, na.rm = TRUE),
                   `Evapotranspiracion (mm)` = sum(`Evapotranspiracion (mm)`, na.rm = TRUE),
                   `Lluvia (mm)` = sum(`Lluvia (mm)`, na.rm = TRUE),
                   `Deficit de presion de vapor (DPV)` = mean(`DPVfinal`, na.rm = TRUE),
                   `Grados Calor (18.3 °C)` = sum(`GC`, na.rm = TRUE),
                   `Grados Frio (18.3 °C)` = sum(`GF`, na.rm = TRUE), 
                   `Grados Calor (10 °C)` = sum(`GC10`, na.rm = TRUE),
                   `Grados Frio (10 °C)` = sum(`GF10`, na.rm = TRUE), 
                   `Grados Calor (15 °C)` = sum(`GC15`, na.rm = TRUE),
                   `Grados Frio (15 °C)` = sum(`GF15`, na.rm = TRUE), 
                   `Grados Calor (24 °C)` = sum(`GC24`, na.rm = TRUE),
                   `Grados Frio (24 °C)` = sum(`GF24`, na.rm = TRUE)) %>%
  dplyr::ungroup() %>%
  dplyr::rename(Date = Date2)

clima_dia <- clima_means %>%
  left_join(clima_temp, by = c("Date")) %>%
  left_join(clima_horas, by = c("Date"))

clima <- clima_dia %>%
  mutate(Date = ceiling_date(Date, "week")) %>%
  group_by(Date) %>%
  summarise(`Temp. Maxima (°C) max` = max(`Temp. Maxima (°C)`,na.rm = TRUE),
            `Temp. Maxima (°C) mean` = mean(`Temp. Maxima (°C)`,na.rm = TRUE),
            `Temp. Maxima (°C) sd` = sd(`Temp. Maxima (°C)`,na.rm = TRUE),
            `Temp. Minima (°C) min` = min(`Temp. Minima (°C)`,na.rm = TRUE),
            `Temp. Minima (°C) mean` = mean(`Temp. Minima (°C)`,na.rm = TRUE),
            `Temp. Minima (°C) sd` = sd(`Temp. Minima (°C)`,na.rm = TRUE),
            `Temp. Media (°C) mean` = mean(`Temp. Media (°C)`,na.rm = TRUE),
            `Temp. Media (°C) sd` = sd(`Temp. Media (°C)`,na.rm = TRUE),
            `Temp. Exterior (°C) mean` = mean(`Temp. Exterior (°C)`,na.rm = TRUE),
            `Temp. Exterior (°C) sd` = sd(`Temp. Exterior (°C)`,na.rm = TRUE),
            `Humedad Externa (%) mean` = mean(`Humedad Externa (%)`,na.rm = TRUE),
            `Humedad Externa (%) sd` = sd(`Humedad Externa (%)`,na.rm = TRUE),
            `Horas Calor sum` = sum(`Horas Calor`, na.rm = TRUE),
            `Horas Calor sd` = sd(`Horas Calor`, na.rm = TRUE),
            `Horas Frio sum` = sum(`Horas Frio`, na.rm = TRUE),
            `Horas Frio sd` = sd(`Horas Frio`, na.rm = TRUE),
            `Dias Grado sum` = sum(`Dias Grado`, na.rm = TRUE),
            `Dias Grado sd` = sd(`Dias Grado`, na.rm = TRUE),
            `Horas Rocio sum` = sum(`Horas Rocio`, na.rm = TRUE),
            `Horas Rocio sd` = sd(`Horas Rocio`, na.rm = TRUE),
            `Lluvia (mm) sum` = sum(`Lluvia (mm)`, na.rm = TRUE),
            `Lluvia (mm) mean` = mean(`Lluvia (mm)`, na.rm = TRUE),
            `Lluvia (mm) sd` = sd(`Lluvia (mm)`, na.rm = TRUE),
            `Radiacion Solar (w/m2) mean` = mean(`Radiacion Solar (w/m2)`, na.rm = TRUE),
            `Radiacion Solar (w/m2) sd` = sd(`Radiacion Solar (w/m2)`, na.rm = TRUE),
            `Evapotranspiracion (mm) sum` = sum(`Evapotranspiracion (mm)`, na.rm = TRUE),
            `Evapotranspiracion (mm) mean` = mean(`Evapotranspiracion (mm)`, na.rm = TRUE),
            `Evapotranspiracion (mm) sd` = sd(`Evapotranspiracion (mm)`, na.rm = TRUE),
            `Punto Rocio (°C) mean` = mean(`Punto Rocio (°C)`, na.rm = TRUE),
            `Punto Rocio (°C) sd` = sd(`Punto Rocio (°C)`, na.rm = TRUE),
            `Vel. Min Viento (km/hr) mean` = mean(`Vel. Min Viento (km/hr)`, na.rm = TRUE),
            `Vel. Min Viento (km/hr) sd` = sd(`Vel. Min Viento (km/hr)`, na.rm = TRUE),
            `Viento Durante un Intervalo mean` = mean(`Viento Durante un Intervalo`, na.rm = TRUE),
            `Viento Durante un Intervalo sd` = sd(`Viento Durante un Intervalo`, na.rm = TRUE),
            `Velocida Max (km/hr) mean` = mean(`Velocida Max (km/hr)`, na.rm = TRUE),
            `Velocida Max (km/hr) sd` = sd(`Velocida Max (km/hr)`, na.rm = TRUE),
            `Factor enfria por Viento (°C) mean` = mean(`Factor enfria por Viento (°C)`, na.rm = TRUE),
            `Factor enfria por Viento (°C) sd` = sd(`Factor enfria por Viento (°C)`, na.rm = TRUE),
            `Indice de Calor mean` = mean(`Indice de Calor`, na.rm = TRUE),
            `Indice de Calor sd` = sd(`Indice de Calor`, na.rm = TRUE),
            `Indice de Tem. Hum. Viento mean` = mean(`Indice de Tem. Hum. Viento`, na.rm = TRUE),
            `Indice de Tem. Hum. Viento sd` = sd(`Indice de Tem. Hum. Viento`, na.rm = TRUE),
            `Presion Atmosfera (mm) mean` = mean(`Presion Atmosfera (mm)`, na.rm = TRUE),
            `Presion Atmosfera (mm) sd` = sd(`Presion Atmosfera (mm)`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) mean` = mean(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) sd` = sd(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Energia solar (w/m2) mean` = mean(`Energia solar (w/m2)`, na.rm = TRUE),
            `Energia solar (w/m2) sd` = sd(`Energia solar (w/m2)`, na.rm = TRUE),
            `Alta Radiacion sol. (w/m2) mean` = mean(`Alta Radiacion sol. (w/m2)`, na.rm = TRUE),
            `Alta Radiacion sol. (w/m2) sd` = sd(`Alta Radiacion sol. (w/m2)`, na.rm = TRUE),
            `Indice Rayos UV mean` = mean(`Indice Rayos UV`, na.rm = TRUE),
            `Indice Rayos UV sd` = sd(`Indice Rayos UV`, na.rm = TRUE),
            # # `Dosis UV mean` = mean(`Dosis UV`, na.rm = TRUE),
            # `Dosis UV sd` = sd(`Dosis UV`, na.rm = TRUE),
            `Alta Radiacion UV mean` = mean(`Alta Radiacion UV`, na.rm = TRUE),
            `Alta Radiacion UV sd` = sd(`Alta Radiacion UV`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) mean` = mean(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Intensidad LLuvia (mm/hr) sd` = sd(`Intensidad LLuvia (mm/hr)`, na.rm = TRUE),
            `Grados Calor (18.3 °C) sum` = sum(`Grados Calor (18.3 °C)`, na.rm = TRUE),
            `Grados Calor (18.3 °C) mean` = mean(`Grados Calor (18.3 °C)`, na.rm = TRUE),
            `Grados Calor (18.3 °C) sd` = sd(`Grados Calor (18.3 °C)`, na.rm = TRUE),
            `Grados Frio (18.3 °C) sum` = sum(`Grados Frio (18.3 °C)`, na.rm = TRUE),
            `Grados Frio (18.3 °C) mean` = mean(`Grados Frio (18.3 °C)`, na.rm = TRUE),
            `Grados Frio (18.3 °C) sd` = sd(`Grados Frio (18.3 °C)`, na.rm = TRUE),
            `Grados Calor (10 °C) sum` = sum(`Grados Calor (10 °C)`, na.rm = TRUE),
            `Grados Calor (10 °C) mean` = mean(`Grados Calor (10 °C)`, na.rm = TRUE),
            `Grados Calor (10 °C) sd` = sd(`Grados Calor (10 °C)`, na.rm = TRUE),
            `Grados Frio (10 °C) sum` = sum(`Grados Frio (10 °C)`, na.rm = TRUE),
            `Grados Frio (10 °C) mean` = mean(`Grados Frio (10 °C)`, na.rm = TRUE),
            `Grados Frio (10 °C) sd` = sd(`Grados Frio (10 °C)`, na.rm = TRUE),
            `Grados Calor (15 °C) sum` = sum(`Grados Calor (15 °C)`, na.rm = TRUE),
            `Grados Calor (15 °C) mean` = mean(`Grados Calor (15 °C)`, na.rm = TRUE),
            `Grados Calor (15 °C) sd` = sd(`Grados Calor (15 °C)`, na.rm = TRUE),
            `Grados Frio (15 °C) sum` = sum(`Grados Frio (15 °C)`, na.rm = TRUE),
            `Grados Frio (15 °C) mean` = mean(`Grados Frio (15 °C)`, na.rm = TRUE),
            `Grados Frio (15 °C) sd` = sd(`Grados Frio (15 °C)`, na.rm = TRUE),
            `Grados Calor (24 °C) sum` = sum(`Grados Calor (24 °C)`, na.rm = TRUE),
            `Grados Calor (24 °C) mean` = mean(`Grados Calor (24 °C)`, na.rm = TRUE),
            `Grados Calor (24 °C) sd` = sd(`Grados Calor (24 °C)`, na.rm = TRUE),
            `Grados Frio (24 °C) sum` = sum(`Grados Frio (24 °C)`, na.rm = TRUE),
            `Grados Frio (24 °C) mean` = mean(`Grados Frio (24 °C)`, na.rm = TRUE),
            `Grados Frio (24 °C) sd` = sd(`Grados Frio (24 °C)`, na.rm = TRUE),
            `Temp. Interna (°C) mean` = mean(`Temp. Interna (°C)`, na.rm = TRUE),
            `Temp. Interna (°C) sd` = sd(`Temp. Interna (°C)`, na.rm = TRUE),
            `Hum. Interna (%) mean` = mean(`Hum. Interna (%)`, na.rm = TRUE),
            `Hum. Interna (%) sd` = sd(`Hum. Interna (%)`, na.rm = TRUE),
            # `Rocio mean` = mean(`Rocio`, na.rm = TRUE),
            # `Rocio sd` = sd(`Rocio`, na.rm = TRUE),
            # `Calor mean` = mean(`Calor`, na.rm = TRUE),
            # `Calor sd` = sd(`Calor`, na.rm = TRUE),
            `Deficit de presion de vapor (DPV) sum` = sum(`Deficit de presion de vapor (DPV)`, na.rm = TRUE),
            `Deficit de presion de vapor (DPV) mean` = mean(`Deficit de presion de vapor (DPV)`, na.rm = TRUE),
            `Deficit de presion de vapor (DPV) sd` = sd(`Deficit de presion de vapor (DPV)`, na.rm = TRUE)
  ) %>%
  dplyr::ungroup() %>%
  dplyr::mutate(Año = as.numeric(format(Date, format = "%Y")),
         Semana = as.numeric(format(Date, format = "%W"))) %>%
  dplyr::group_by(Año) %>%
  dplyr::mutate(`Horas Calor cumsum` = cumsum(`Horas Calor sum`),
                `Horas Frio cumsum` = cumsum(`Horas Frio sum`),
                `Horas Rocio cumsum` = cumsum(`Horas Rocio sum`),
                `Radiacion Solar (w/m2) cumsum` = cumsum(`Radiacion Solar (w/m2) mean`),
                `Dias Grado cumsum` = cumsum(`Dias Grado sum`),
                `Evapotranspiracion (mm) cumsum` = cumsum(`Evapotranspiracion (mm) sum`),
                `Lluvia (mm) cumsum` = cumsum(`Lluvia (mm) sum`),
                `Deficit de presion de vapor (DPV) cumsum` = cumsum(`Deficit de presion de vapor (DPV) sum`),
                `Diferencial termico` = `Temp. Maxima (°C) max` - 
                  `Temp. Minima (°C) min`,
                `Diferencial termico cumsum` = cumsum(`Diferencial termico`)) %>%
  dplyr::ungroup() %>%
  dplyr::filter(!Año == 2018)

write.csv(clima, "data_macrotuneles.csv", row.names = F)
```

### Temperatura

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Temp. Maxima (°C) max`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Temperatura (°C) máxima",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(18,37), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Temp. Media (°C) mean`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Temperatura (°C) media",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(15,28), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Temp. Minima (°C) min`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Temperatura (°C) mínima",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(10,24), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

### Diferencial térmico

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Diferencial termico`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Diferencial térmico (°C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,20), breaks=0:100*2,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

### Horas calor (>= 24 °C) y Horas frío (<= 15 °C)

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Calor sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Horas calor (>= 24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Frio sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Horas frío (<= 15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	


```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Horas Calor sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Horas Calor cumsum` = cumsum(`Horas Calor sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Calor cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Horas calor (>= 24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1300), breaks=0:100*100,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Frio cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Horas frío (<= 15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,900), breaks=0:100*100,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Horas rocío

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Rocio sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Horas rocío",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,10), breaks=0:100*1,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Horas Rocio sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Horas Rocio cumsum` = cumsum(`Horas Rocio sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Horas Rocio cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Horas rocío",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,70), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Radiación solar

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Radiacion Solar (w/m2) mean`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Radiación solar (W/m²)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "W/m²")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(200,1100), breaks=0:100*50,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Radiacion Solar (w/m2) mean`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Radiacion Solar (w/m2) cumsum` = cumsum(`Radiacion Solar (w/m2) mean`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Radiacion Solar (w/m2) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Radiación solar (W/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "Horas acumuladas")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
   scale_y_continuous(limits = c(0,50000), breaks=0:100*5000,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	


### Grados de calor y frio {.tabset .tabset-fade .tabset-pills}

#### Base 10 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (10 °C)` = `Grados Calor (10 °C) sum`,
         `Grados frío (10 °C)` = `Grados Frio (10 °C) sum`) %>%
  select(Date,`Grados calor (10 °C)`,`Grados frío (10 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (10 °C)",
                                           "frío (10 °C)"),
                                labels = c("Grados calor (10 °C)",
                                           "Grados frío (10 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (10 °C) y Grados frío (10 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (10 °C)` = `Grados Calor (10 °C) sum`,
         `Grados frío (10 °C)` = `Grados Frio (10 °C) sum`) %>%
  select(Date,`Grados calor (10 °C)`,`Grados frío (10 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (10 °C)",
                                           "frío (10 °C)"),
                                labels = c("Grados calor (10 °C)",
                                           "Grados frío (10 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (10 °C)",
                                           "frío (10 °C)"),
                                labels = c("Grados calor (10 °C)",
                                           "Grados frío (10 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (10 °C) y Grados frío (10 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,4000), breaks=0:100*500,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```
#### Base 15 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (15 °C)` = `Grados Calor (15 °C) sum`,
         `Grados frío (15 °C)` = `Grados Frio (15 °C) sum`) %>%
  select(Date,`Grados calor (15 °C)`,`Grados frío (15 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (15 °C)",
                                           "frío (15 °C)"),
                                labels = c("Grados calor (15 °C)",
                                           "Grados frío (15 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (15 °C) y Grados frío (15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,100), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (15 °C)` = `Grados Calor (15 °C) sum`,
         `Grados frío (15 °C)` = `Grados Frio (15 °C) sum`) %>%
  select(Date,`Grados calor (15 °C)`,`Grados frío (15 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (15 °C)",
                                           "frío (15 °C)"),
                                labels = c("Grados calor (15 °C)",
                                           "Grados frío (15 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (15 °C)",
                                           "frío (15 °C)"),
                                labels = c("Grados calor (15 °C)",
                                           "Grados frío (15 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (15 °C) y Grados frío (15 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,65), breaks=0:100*500,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```

#### Base 18.3 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (18.3 °C)` = `Grados Calor (18.3 °C) sum`,
         `Grados frío (18.3 °C)` = `Grados Frio (18.3 °C) sum`) %>%
  select(Date,`Grados calor (18.3 °C)`,`Grados frío (18.3 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (18.3 °C)",
                                           "frío (18.3 °C)"),
                                labels = c("Grados calor (18.3 °C)",
                                           "Grados frío (18.3 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (18.3 °C) y Grados frío (18.3 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,80), breaks=0:100*10,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (18.3 °C)` = `Grados Calor (18.3 °C) sum`,
         `Grados frío (18.3 °C)` = `Grados Frio (18.3 °C) sum`) %>%
  select(Date,`Grados calor (18.3 °C)`,`Grados frío (18.3 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (18.3 °C)",
                                           "frío (18.3 °C)"),
                                labels = c("Grados calor (18.3 °C)",
                                           "Grados frío (18.3 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (18.3 °C)",
                                           "frío (18.3 °C)"),
                                labels = c("Grados calor (18.3 °C)",
                                           "Grados frío (18.3 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (18.3 °C) y Grados frío (18.3 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1500), breaks=0:100*250,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```

#### Base 24 °C

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (24 °C)` = `Grados Calor (24 °C) sum`,
         `Grados frío (24 °C)` = `Grados Frio (24 °C) sum`) %>%
  select(Date,`Grados calor (24 °C)`,`Grados frío (24 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  )

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Y,
                 group = factor(Tipo),
                 color = factor(Tipo,
                                levels = c("calor (24 °C)",
                                           "frío (24 °C)"),
                                labels = c("Grados calor (24 °C)",
                                           "Grados frío (24 °C)")))) +
  geom_line(linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (24 °C) y Grados frío (24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,120), breaks=0:100*20,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  rename(`Grados calor (24 °C)` = `Grados Calor (24 °C) sum`,
         `Grados frío (24 °C)` = `Grados Frio (24 °C) sum`) %>%
  select(Date,`Grados calor (24 °C)`,`Grados frío (24 °C)`)%>%
  pivot_longer(
    cols = starts_with("Grados "),
    names_to = c("Tipo"),
    names_prefix = "Grados ",
    values_to = "Y",
    names_repair = "minimal"
  ) %>%
  mutate(Año = year(Date)) %>%
  group_by(Año, Tipo) %>%
  mutate(Ycum = cumsum(Y))

p <- ggplot(data = clima2, # selecciono la data del modelo (aov o data.frame)
             aes(x = Date,
                 y = Ycum,
                 group = factor(Tipo),
                 fill = factor(Tipo,
                                levels = c("calor (24 °C)",
                                           "frío (24 °C)"),
                                labels = c("Grados calor (24 °C)",
                                           "Grados frío (24 °C)")),
                 color = factor(Tipo,
                                levels = c("calor (24 °C)",
                                           "frío (24 °C)"),
                                labels = c("Grados calor (24 °C)",
                                           "Grados frío (24 °C)")))) +
  geom_col(linetype = 1,  # geom_line -> agrega líneas
           size = 0.5,
           position = "dodge",
           alpha = 1,
           na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Grados calor (24 °C) y Grados frío (24 °C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,2000), breaks=0:100*250,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_date(date_labels = "%b/%y", date_breaks = "1 month") +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```

### Días grado {.tabset .tabset-fade .tabset-pills}

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Dias Grado sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Días Grado (°C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(30,130), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Dias Grado sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Dias Grado cumsum` = cumsum(`Dias Grado sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Dias Grado cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Días Grado (°C)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "°C acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,4500), breaks=0:100*500,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Humedad relativa

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Humedad Externa (%) mean`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Humedad relativa (%)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "%")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(30,100), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

### Evapotranspiración

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Evapotranspiracion (mm) sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Evapotranspiración (mm/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m²")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,45), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Evapotranspiracion (mm) sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Evapotranspiracion (mm) cumsum` = cumsum(`Evapotranspiracion (mm) sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Evapotranspiracion (mm) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Evapotranspiración (mm/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m² acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1100), breaks=0:100*50,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Precipitación pluvial

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Lluvia (mm) sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Precipitación pluvial (mm/m²)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m²")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,5), breaks=0:100*1,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Lluvia (mm) sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Lluvia (mm) cumsum` = cumsum(`Lluvia (mm) sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Lluvia (mm) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       #subtitle = "Horas calor (>= 24 °C) y Horas frío (<= 15 °C)",
       title = "Precipitación pluvial (mm/m²)",
       # caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "mm/m² acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,25), breaks=0:100*5,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	

### Déficit de presión de vapor

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Deficit de presion de vapor (DPV) sum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) +
  # geom_ribbon(aes(ymin = `Evapotranspiracion (mm) mean` -
  #                   `Evapotranspiracion (mm) sd`,
  #                 ymax = `Evapotranspiracion (mm) mean` +
  #                   `Evapotranspiracion (mm) sd`), 
  #             alpha = 0.1, 
  #             linetype = "dashed",
  #             color = "green",
  #             fill = "green") + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 6.25,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Déficit de presión de vapor (DPV)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "KPa")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,30), breaks=0:100*10,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 7.25, ymax = 8.1)
ggplotly(p) %>% style(hoverinfo = "x unified") %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
```	

```{r, echo = F, eval=T, message=F, comment="", warning= F, fig.align='center',fig.height=7.5, fig.width=12}
clima2 <- clima %>%
  select(Date,`Deficit de presion de vapor (DPV) sum`)%>%
  mutate(Año = year(Date)) %>%
  group_by(Año) %>%
  mutate(`Deficit de presion de vapor (DPV) cumsum` = cumsum(`Deficit de presion de vapor (DPV) sum`))

p <- ggplot(data = clima, # selecciono la data del modelo (aov o data.frame)
             aes(x = Semana,
                 group = factor(Año),
                 colour = factor(Año))) +
  geom_line(aes(y = `Deficit de presion de vapor (DPV) cumsum`),
            linetype=1,  # geom_line -> agrega líneas
            size=0.5,
            position=position_dodge(width=0),
            alpha = 1,na.rm = T) + 
  # annotate(geom = "vline",
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            xintercept = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            linetype = c("dashed"))+
  # annotate(geom = "text",
  #            label = c("Otoño 2021","Invierno 2021","Primavera 2021","Verano 2022",
  #                  "Otoño 2020","Invierno 2020","Primavera 2020","Verano 2021",
  #                  "Otoño 2019","Invierno 2019","Primavera 2019","Verano 2020",
  #                  "Otoño 2018","Invierno 2018","Primavera 2018","Verano 2019"),
  #            x = as.Date(c("2021-03-20","2021-06-21","2021-09-22","2021-12-21",
  #                          "2020-03-20","2020-06-21","2020-09-22","2020-12-21",
  #                          "2019-03-20","2019-06-21","2019-09-19","2019-12-21",
  #                          "2018-03-20","2018-06-21","2018-09-22","2018-12-21")),
  #            y = 145,
  #            angle = 90, 
  #            vjust = 1,
  #          size = 3.5)+
  labs(#title = "Reporte Histórico de Clima",
       title = "Déficit de presión de vapor (DPV)",
       #caption="Fuente: Variables meteorológicas F3_26-01-2022.xlsx\nActualizado a la Semana 2\nAutor: Mg(c). Christian Vásquez Velasco",color = "",
       color = "",
       shape = "",
       fill = "",
       x = "Semana", # título de eje x
       y = "KPa acumulados")+ #unidades . hoja^-1
  # geom_label_repel(color = 'white',
  #                  arrow = NULL,
  #                  size = 2) +
  #scale_colour_viridis_d(option = "I")+
  scale_y_continuous(limits = c(0,1000), breaks=0:100*50,
                     expand = c(0.1,0.1)) +#,
                    # breaks=-100:100*1) +
  scale_x_continuous(breaks = 0:100*1) +
  theme_elegante()#+
  # annotation_custom(rasterGrob(image2,
  #                              width = unit(1,"npc"),
  #                              height = unit(1,"npc")),
  #                   xmin = as.Date("2019-06-01"), xmax = as.Date("2020-06-01"),
  #                   ymin = 167.5, ymax = 187.5)
ggplotly(p) %>% style(hoverinfo = c("x unified")) %>% 
  layout(legend = list(orientation = 'h')) %>%
  layout(legend = list(x = 0, y = 1))
# fig <- plotly_build(p)
# fig$x$data[[1]]$mode <- 'lines'
# fig$x$data[[2]]$mode <- 'lines'
# fig %>% style(hoverinfo = "y")
```	